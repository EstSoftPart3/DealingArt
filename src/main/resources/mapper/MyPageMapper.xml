<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.da.mapper.MyPageMapper">

	<select id="myCouponList_payment" resultType="hashMap" parameterType="String">
	/* 쿠폰 리스트 - 결제 */
		SELECT 
			 CM.CUPON_SQ										as cuponSq
			,CM.CUPON_DIV_CD									as cuponDivCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_DIV_CD
			) 													as cuponDivNm
			,CM.CUPON_TYP_CD 									as cuponTypCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_TYP_CD
			) 													as cuponTypNm
			,CM.CUPON_DETAIL_CD 								as cuponDetailCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_DETAIL_CD
			) 													as cuponDetailNm
			,CM.DISC_TYP_CD 									as discTypCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.DISC_TYP_CD
			) 													as discTypNm
			,CM.CUPON_DR 										as cuponDr 			
			,CM.CUPON_DISC_AMT 									as cuponDiscAmt 		
			,CM.CUPON_IDNTFCTN_NUM 								as cuponIdntfctnNum 
			,CM.CUPON_NM 										as cuponNm 			
			,CM.CUPON_CNTNT 									as cuponCntnt 		
			,DATE_FORMAT(MCR.USE_STRT_DT, '%Y.%m.%d %H:%i')		as useStrtDt		
			,DATE_FORMAT(MCR.USE_END_DT, '%Y.%m.%d %H:%i')      as useEndDt       
			,CM.REG_MBR_SQ                                      as regMbrSq         
			,CM.REG_DT                                          as regDt             
			,CM.UPDT_MBR_SQ                                     as updtMbrSq        
			,CM.UPDT_DT                                         as updtDt            
			,CM.USE_YN                                          as useYn             
			,CM.DEL_YN                                          as delYn             
			,TIMESTAMPDIFF(DAY, MCR.USE_END_DT, CURDATE()) 	    as diffDay
			,MCR.CUPON_USE_YN									as cuponUseYn	
			,MCR.CUPON_USE_DT                                   as cuponUseDt
		FROM TBL_DA_CUPON_M CM
		INNER JOIN TBL_DA_MBR_CUPON_R MCR
		ON CM.CUPON_SQ = MCR.CUPON_SQ
		WHERE (CM.USE_YN = 'Y' AND CM.DEL_YN = 'N')
		AND (
				(
					CM.CUPON_DIV_CD = "IU" 
					AND NOW() <![CDATA[<=]]> MCR.USE_END_DT)
				OR (
					CM.CUPON_DIV_CD = "TU" 
					AND (NOW() <![CDATA[>=]]> MCR.USE_STRT_DT AND NOW() <![CDATA[<=]]> MCR.USE_END_DT)
					)
		)
		AND MCR.MBR_SQ = #{mbrSq}
		AND CM.CUPON_TYP_CD = #{cuponTypCd}
		AND MCR.CUPON_USE_YN = 'N'
	</select>

	<select id="myCouponList" resultType="hashMap" parameterType="String">
	/* 쿠폰 리스트 - 목록*/
		SELECT 
			 CM.CUPON_SQ										as cuponSq
			,CM.CUPON_DIV_CD									as cuponDivCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_DIV_CD
			) 													as cuponDivNm
			,CM.CUPON_TYP_CD 									as cuponTypCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_TYP_CD
			) 													as cuponTypNm
			,CM.CUPON_DETAIL_CD 								as cuponDetailCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.CUPON_DETAIL_CD
			) 													as cuponDetailNm
			,CM.DISC_TYP_CD 									as discTypCd
			,(
				select CDCS.DTL_CD_NM
				from TBL_DA_COMN_DTL_CD_S CDCS 
				where (CDCS.USE_YN='Y' and CDCS.DEL_YN='N')
				and CDCS.DTL_CD=CM.DISC_TYP_CD
			) 													as discTypNm
			,CM.CUPON_DR 										as cuponDr 			
			,CM.CUPON_DISC_AMT 									as cuponDiscAmt 		
			,CM.CUPON_IDNTFCTN_NUM 								as cuponIdntfctnNum 
			,CM.CUPON_NM 										as cuponNm 			
			,CM.CUPON_CNTNT 									as cuponCntnt 		
			,DATE_FORMAT(MCR.USE_STRT_DT, '%Y.%m.%d %H:%i')		as useStrtDt		
			,DATE_FORMAT(MCR.USE_END_DT, '%Y.%m.%d %H:%i')      as useEndDt         
			,CM.REG_MBR_SQ                                      as regMbrSq         
			,CM.REG_DT                                          as regDt             
			,CM.UPDT_MBR_SQ                                     as updtMbrSq        
			,CM.UPDT_DT                                         as updtDt            
			,CM.USE_YN                                          as useYn             
			,CM.DEL_YN                                          as delYn             
			,TIMESTAMPDIFF(DAY, MCR.USE_END_DT, CURDATE()) 		as diffDay
			,MCR.CUPON_USE_YN									as cuponUseYn	
			,MCR.CUPON_USE_DT                                   as cuponUseDt
		FROM TBL_DA_CUPON_M CM
		INNER JOIN TBL_DA_MBR_CUPON_R MCR
		ON CM.CUPON_SQ = MCR.CUPON_SQ
		WHERE (CM.USE_YN = 'Y' AND CM.DEL_YN = 'N')
		AND MCR.MBR_SQ = #{mbrSq}
	</select>
	
	<select id="searchCuponIdntfctnNum" resultType="hashMap" parameterType="hashMap">
	/* 쿠폰식별번호 조회 */
		SELECT 
			 CM.CUPON_SQ										as cuponSq
			,CM.CUPON_IDNTFCTN_NUM 								as cuponIdntfctnNum 
			,CM.USE_STRT_DT										as useStrtDt 		
			,CM.USE_END_DT          							as useEndDt       
			<!-- ,TIMESTAMPDIFF(DAY, CM.USE_END_DATE, CURDATE()) 	as diffDay -->
		FROM TBL_DA_CUPON_M CM
		WHERE (CM.USE_YN = 'Y' AND CM.DEL_YN = 'N')
		AND CM.CUPON_IDNTFCTN_NUM = #{cuponIdntfctnNum}
	</select>
	
	<select id="cntCouponOverlap" resultType="int" parameterType="hashMap">
		/* 쿠폰중복등록 카운트 */
		SELECT
			COUNT(*)
		FROM TBL_DA_MBR_CUPON_R
		WHERE CUPON_SQ = #{cuponSq} AND MBR_SQ = #{mbrSq}
	</select>
	
	<insert id="insertCouponReg">
		/*쿠폰 등록*/
		INSERT INTO TBL_DA_MBR_CUPON_R	(
			 CUPON_SQ 
			,MBR_SQ 
			,CUPON_USE_YN
			,USE_STRT_DT
			,USE_END_DT
		)VALUES(
			#{cuponSq} 
			,#{mbrSq} 
			,'N'
			<if test="useStrtDt != null and useStrtDt != ''">
			,${useStrtDt}
			</if>
			<if test="useEndDt != null and useEndDt != ''">
			,${useEndDt}
			</if>
			
		);
	</insert>

	
	<select id="myDealSearchListSale" resultType="hashMap" parameterType="hashMap">
		/*거래내역 정찰가 리스트*/
		SELECT 
				B.DEAL_SQ AS dealSq,
				B.SELL_MBR_SQ AS sellMbrSq,
				B.BUY_MBR_SQ AS buyMbrSq,
				B.WORK_SQ AS workSq,
				B.ARTST_SQ AS artstSq,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.WORK_NM AS workNm,
				A.WORK_PRODC_YEAR AS workProdcYear,
				B.DEAL_TYP_CD AS dealTypCd,
				B.DEAL_STTS_CD AS dealSttsCd,
				B.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd,
				B.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd,
				DATE_FORMAT(B.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				FORMAT(B.DEAL_STRT_PRC, 0) AS dealStrtPrc,
				FORMAT(B.DEAL_FINAL_PRC, 0) AS dealFinalPrc,
				B.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A,
				TBL_DA_DEAL_M AS B
		WHERE 
				A.WORK_SQ = B.WORK_SQ 
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			AND B.DEAL_TYP_CD = 'S'
			<if test="buyOrSell == 'BUY'">
				AND B.BUY_MBR_SQ = #{mbrSq}
			</if>
			<if test="buyOrSell == 'SELL'">
				AND B.SELL_MBR_SQ = #{mbrSq}
			</if>
			<if test="buyOrSell == 'ALL'">
				AND (B.BUY_MBR_SQ = #{mbrSq}
				OR B.SELL_MBR_SQ = #{mbrSq})
			</if>
			<if test="dealSttsCd == 'TP'">
				AND B.DEAL_STTS_CD = 'TP'
			</if>
			<if test="dealSttsCd == 'TC'">
				AND B.DEAL_STTS_CD = 'TC'
			</if>
			<if test="dealSttsCd == 'PD'">
				AND B.DEAL_STTS_CD = 'PD'
			</if>
			<if test="dealSttsCd == 'DS'">
				AND B.DEAL_STTS_CD = 'DS'
			</if>
			<if test="dealSttsCd == 'DC'">
				AND B.DEAL_STTS_CD = 'DC'
			</if>
			<if test="dealSttsCd == 'PC'">
				AND B.DEAL_STTS_CD = 'PC'
			</if>
			<if test="dealSttsCd == 'FB'">
				AND B.DEAL_STTS_CD = 'FB'
			</if>
			<if test="searchKeyword != null and searchKeyword != ''">
				AND (
						A.ARTST_ACTVTY_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.ARTST_ENGLS_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.WORK_NM LIKE CONCAT('%',#{searchKeyword},'%')
					)
			</if>
			<if test="searchStrtDate != null and searchStrtDate != '' and searchEndngDate != null and searchEndngDate != ''">
				AND DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d') BETWEEN #{searchStrtDate} AND #{searchEndngDate}
			</if>
		GROUP BY B.DEAL_SQ;
	</select>
	
	<select id="myDealSearchListVACCT" parameterType="hashMap" resultType="hashMap">
		/* 거래내역 정찰가 가상계좌 입금전 리스트 */
		SELECT 
				B.DEAL_SQ AS dealSq,
				<if test="buyOrSell == 'ALL'">
				IFNULL(B.SELL_MBR_SQ, (SELECT PH.MBR_SQ FROM TBL_DA_PAYMNT_H PH WHERE PH.MBR_SQ = #{mbrSq} AND PH.PAYMNT_DIV_CD = 'S' AND PH.DEAL_SQ = B.DEAL_SQ) ) AS sellMbrSq,
				IFNULL(B.BUY_MBR_SQ, (SELECT PH.MBR_SQ FROM TBL_DA_PAYMNT_H PH WHERE PH.MBR_SQ = #{mbrSq} AND PH.PAYMNT_DIV_CD = 'B' AND PH.DEAL_SQ = B.DEAL_SQ) ) AS buyMbrSq,
				</if>
				<if test="buyOrSell == 'SELL'">
				IFNULL(B.SELL_MBR_SQ, (SELECT PH.MBR_SQ FROM TBL_DA_PAYMNT_H PH WHERE PH.MBR_SQ = #{mbrSq} AND PH.PAYMNT_DIV_CD = 'S' AND PH.DEAL_SQ = B.DEAL_SQ) ) AS sellMbrSq,
				</if>
				<if test="buyOrSell == 'BUY'">
				IFNULL(B.BUY_MBR_SQ, (SELECT PH.MBR_SQ FROM TBL_DA_PAYMNT_H PH WHERE PH.MBR_SQ = #{mbrSq} AND PH.PAYMNT_DIV_CD = 'B' AND PH.DEAL_SQ = B.DEAL_SQ) ) AS buyMbrSq,
				</if>
				B.WORK_SQ AS workSq,
				B.ARTST_SQ AS artstSq,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.WORK_NM AS workNm,
				A.WORK_PRODC_YEAR AS workProdcYear,
				B.DEAL_TYP_CD AS dealTypCd,
				B.DEAL_STTS_CD AS dealSttsCd,
				B.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd,
				B.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd,
				DATE_FORMAT(B.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				FORMAT(B.DEAL_STRT_PRC, 0) AS dealStrtPrc,
				FORMAT(B.DEAL_FINAL_PRC, 0) AS dealFinalPrc,
				B.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_DEAL_M AS B
			ON	A.WORK_SQ = B.WORK_SQ
		INNER JOIN
				TBL_DA_PAYMNT_H AS C
			ON	B.DEAL_SQ = C.DEAL_SQ
			AND C.PAYMETHOD = 'VACCT'
			AND C.MBR_SQ = #{mbrSq}
			<!-- <if test="buyOrSell == 'ALL'">
			AND (C.PAYMNT_DIV_CD = 'B' OR C.PAYMNT_DIV_CD = 'S')
			</if>
			<if test="buyOrSell == 'BUY'">
			AND C.PAYMNT_DIV_CD = 'B'
			</if>
			<if test="buyOrSell == 'SELL'">
			AND C.PAYMNT_DIV_CD = 'S'
			</if> -->
		WHERE 
				B.DEAL_TYP_CD = 'S'
		  AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			<if test="dealSttsCd == 'ALL'">
				AND B.DEAL_STTS_CD = 'TP'
			</if>
			<if test="dealSttsCd == 'TP'">
				AND B.DEAL_STTS_CD = 'TP'
			</if>
			<if test="dealSttsCd == 'TC'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="dealSttsCd == 'PD'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="dealSttsCd == 'DS'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="dealSttsCd == 'DC'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="dealSttsCd == 'PC'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="dealSttsCd == 'FB'">
				AND B.DEAL_STTS_CD IS NULL
			</if>
			<if test="searchKeyword != null and searchKeyword != ''">
				AND (
						A.ARTST_ACTVTY_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.ARTST_ENGLS_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.WORK_NM LIKE CONCAT('%',#{searchKeyword},'%')
					)
			</if>
			<if test="searchStrtDate != null and searchStrtDate != '' and searchEndngDate != null and searchEndngDate != ''">
				AND DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d') BETWEEN #{searchStrtDate} AND #{searchEndngDate}
			</if>
		GROUP BY B.DEAL_SQ;
	</select>
	
	<select id="myDealSearchListAuctionBuy" resultType="hashMap" parameterType="hashMap">
		/*거래내역 구매 경매 리스트*/
		SELECT 
				C.DEAL_SQ AS dealSq, /*거래순번*/
				A.WORK_SQ AS workSq, /*작품번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				A.ARTST_BIRTH_YEAR AS artstBirthYear, /*작가생년월일*/
				C.DEAL_TYP_CD AS dealTypCd, /*거래유형*/
				C.DEAL_STTS_CD AS dealSttsCd, /*거래상태*/
				A.WORK_NM AS workNm, /*작품명*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				C.MBR_REF_NO AS mbrRefNo, /*거래주문코드*/
				C.BUY_MBR_SQ AS buyMbrSq, /*거래구매자순번*/
				C.SELL_MBR_SQ AS sellMbrSq, /*거래판매자순번*/
				C.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd, /*거래구매자결제상태*/
				C.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd, /*거래판매자결제상태*/
				(SELECT FORMAT(MAX(BID_PRC), 0)
				FROM TBL_DA_AUCTN_BID_H
				WHERE C.DEAL_SQ = DEAL_SQ) AS maxBidPrc, /*응찰가*/
				FORMAT(C.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*거래시작가격*/
				FORMAT(C.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*거래낙찰가격*/
				FORMAT(C.DEAL_FINAL_PRC, 0) AS dealFinalPrc, /*거래최종가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE C.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				(SELECT MBR_SQ 
				FROM TBL_DA_AUCTN_BID_H
				WHERE C.DEAL_SQ = DEAL_SQ
				ORDER BY BID_DATE DESC LIMIT 1) AS bidMbrSq, /*마지막 응찰 회원 순번*/
				DATE_FORMAT(C.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작날짜*/
				DATE_FORMAT(C.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료날짜*/
				C.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		INNER JOIN 
				TBL_DA_DEAL_M AS C
			ON 	A.WORK_SQ = C.WORK_SQ 
		INNER JOIN 
				TBL_DA_AUCTN_BID_H AS D
			ON C.DEAL_SQ = D.DEAL_SQ 
		WHERE 	
				C.DEAL_TYP_CD = 'A'
			AND	D.MBR_SQ IN (#{mbrSq})
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			<if test="dealSttsCd == 'TP'">
				AND C.DEAL_STTS_CD = 'TP'
			</if>
			<if test="dealSttsCd == 'TC'">
				AND C.DEAL_STTS_CD = 'TC'
			</if>
			<if test="dealSttsCd == 'PD'">
				AND C.DEAL_STTS_CD = 'PD'
			</if>
			<if test="dealSttsCd == 'DS'">
				AND C.DEAL_STTS_CD = 'DS'
			</if>
			<if test="dealSttsCd == 'DC'">
				AND C.DEAL_STTS_CD = 'DC'
			</if>
			<if test="dealSttsCd == 'PC'">
				AND C.DEAL_STTS_CD = 'PC'
			</if>
			<if test="dealSttsCd == 'FB'">
				AND C.DEAL_STTS_CD = 'FB'
			</if>
			<if test="searchKeyword != null and searchKeyword != ''">
				AND (
						A.ARTST_ACTVTY_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.ARTST_ENGLS_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.WORK_NM LIKE CONCAT('%',#{searchKeyword},'%')
					)
			</if>
			<if test="searchStrtDate != null and searchStrtDate != '' and searchEndngDate != null and searchEndngDate != ''">
				AND DATE_FORMAT(C.DEAL_ENDNG_DT, '%Y.%m.%d') BETWEEN #{searchStrtDate} AND #{searchEndngDate}
			</if>
		GROUP BY C.DEAL_SQ;
	</select>
	<select id="myDealSearchListAuctionSell" resultType="hashMap" parameterType="hashMap">
		/*거래내역 판매 경매 리스트*/
		SELECT 
				C.DEAL_SQ AS dealSq, /*거래순번*/
				A.WORK_SQ AS workSq, /*작품번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				A.ARTST_BIRTH_YEAR AS artstBirthYear, /*작가생년월일*/
				C.DEAL_TYP_CD AS dealTypCd, /*거래유형*/
				C.DEAL_STTS_CD AS dealSttsCd, /*거래상태*/
				A.WORK_NM AS workNm, /*작품명*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				C.MBR_REF_NO AS mbrRefNo, /*거래주문코드*/
				C.BUY_MBR_SQ AS buyMbrSq, /*거래구매자순번*/
				C.SELL_MBR_SQ AS sellMbrSq, /*거래판매자순번*/
				C.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd, /*거래구매자결제상태*/
				C.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd, /*거래판매자결제상태*/
				(SELECT FORMAT(MAX(BID_PRC), 0)
				FROM TBL_DA_AUCTN_BID_H
				WHERE C.DEAL_SQ = DEAL_SQ) AS maxBidPrc, /*응찰가*/
				FORMAT(C.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*거래시작가격*/
				FORMAT(C.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*거래낙찰가격*/
				FORMAT(C.DEAL_FINAL_PRC, 0) AS dealFinalPrc, /*거래최종가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE C.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				(SELECT MBR_SQ 
				FROM TBL_DA_AUCTN_BID_H
				WHERE C.DEAL_SQ = DEAL_SQ
				ORDER BY BID_DATE DESC LIMIT 1) AS bidMbrSq, /*마지막 응찰 회원 순번*/
				DATE_FORMAT(C.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작날짜*/
				DATE_FORMAT(C.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료날짜*/
				C.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		INNER JOIN 
				TBL_DA_DEAL_M AS C
			ON 	A.WORK_SQ = C.WORK_SQ 
		WHERE 	
				C.DEAL_TYP_CD = 'A'
			AND	C.SELL_MBR_SQ = #{mbrSq}
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			<if test="dealSttsCd == 'TP'">
				AND C.DEAL_STTS_CD = 'TP'
			</if>
			<if test="dealSttsCd == 'TC'">
				AND C.DEAL_STTS_CD = 'TC'
			</if>
			<if test="dealSttsCd == 'PD'">
				AND C.DEAL_STTS_CD = 'PD'
			</if>
			<if test="dealSttsCd == 'DS'">
				AND C.DEAL_STTS_CD = 'DS'
			</if>
			<if test="dealSttsCd == 'DC'">
				AND C.DEAL_STTS_CD = 'DC'
			</if>
			<if test="dealSttsCd == 'PC'">
				AND C.DEAL_STTS_CD = 'PC'
			</if>
			<if test="dealSttsCd == 'FB'">
				AND C.DEAL_STTS_CD = 'FB'
			</if>
			<if test="searchKeyword != null and searchKeyword != ''">
				AND (
						A.ARTST_ACTVTY_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.ARTST_ENGLS_NM LIKE CONCAT('%',#{searchKeyword},'%')
						OR A.WORK_NM LIKE CONCAT('%',#{searchKeyword},'%')
					)
			</if>
			<if test="searchStrtDate != null and searchStrtDate != '' and searchEndngDate != null and searchEndngDate != ''">
				AND DATE_FORMAT(C.DEAL_ENDNG_DT, '%Y.%m.%d') BETWEEN #{searchStrtDate} AND #{searchEndngDate}
			</if>
		GROUP BY C.DEAL_SQ;
	</select>
	
	<insert id="collectionReg">
		/*소장품 등록*/
		INSERT INTO 
					TBL_DA_WORK_M (
						MBR_SQ,
						WORK_TYP_CD,
						ARTST_ACTVTY_NM,
						WORK_NM,
						WORK_FRM_YN,
						WORK_CLR_CD,
						WORK_SHP_CD,
						WORK_CLSFC_CD,
						WORK_IMG_FRT_URL, 
						REG_DT,
						REG_MBR_SQ,
						UPDT_DT,
						UPDT_MBR_SQ
						<if test="artstEnglsNm != null and artstEnglsNm != ''">
							,ARTST_ENGLS_NM
						</if>
						<if test="artstSq != null and artstSq != ''">
							,ARTST_SQ
						</if>
						<if test="artstBirthYear != null and artstBirthYear != ''">
							,ARTST_BIRTH_YEAR
						</if> 
						<if test="workPrc != null and workPrc != ''">
							,WORK_PRC
						</if> 
						<if test="workSizeWidth != null and workSizeWidth != ''">
							,WORK_SIZE_WIDTH
						</if> 
						<if test="workSizeDepth != null and workSizeDepth != ''">
							,WORK_SIZE_DEPTH
						</if> 
						<if test="workMatrl != null and workMatrl != ''">
							,WORK_MATRL 
						</if> 
						<if test="workProdcYear != null and workProdcYear != ''">
							,WORK_PRODC_YEAR 
						</if> 
						<if test="workVideoUrl != null and workVideoUrl != ''">
							,WORK_VIDEO_URL
						</if> 
						<if test="workIntrdc != null and workIntrdc != ''">
							,WORK_INTRDC
						</if>
						<if test="workMainImgUrl != null and workMainImgUrl != ''">
							,WORK_MAIN_IMG_URL
						</if>
						<if test="workImgRerUrl != null and workImgRerUrl != ''">
							,WORK_IMG_RER_URL
						</if> 
						<if test="workGrtUrl != null and workGrtUrl != ''">
							,WORK_GRT_URL
						</if>
						<if test="workImgLefUrl != null and workImgLefUrl != ''">
							,WORK_IMG_LEF_URL
						</if>
						<if test="workImgRitUrl != null and workImgRitUrl != ''">
							,WORK_IMG_RIT_URL
						</if>
						<if test="workImgTopUrl != null and workImgTopUrl != ''">
							,WORK_IMG_TOP_URL
						</if>
						<if test="workImgBotUrl != null and workImgBotUrl != ''">
							,WORK_IMG_BOT_URL
						</if>
						<if test="workLake != null and workLake != ''">
							,WORK_LAKE
						</if>
						<if test="workState != null and workState != ''">
							,WORK_STATE
						</if>
						,WORK_OPEN_YN
					)
				VALUES (
						#{mbrSq}, 
						#{workTypCd}, 
						#{artstActvtyNm}, 
						#{workNm}, 
						#{workFrmYn}, 
						#{workClrCd},
						#{workShpCd},
						#{workClsfcCd},
						#{workImgFrtUrl}, 
						NOW(),
						#{mbrSq},
						NOW(),
						#{mbrSq}
						<if test="artstEnglsNm != null and artstEnglsNm != ''">
							,#{artstEnglsNm}
						</if>
						<if test="artstSq != null and artstSq != ''">
							,#{artstSq}
						</if>
						<if test="artstBirthYear != null and artstBirthYear != ''">
							,#{artstBirthYear}
						</if> 
						<if test="workPrc != null and workPrc != ''">
							,#{workPrc}
						</if> 
						<if test="workSizeWidth != null and workSizeWidth != ''">
							,#{workSizeWidth}
						</if> 
						<if test="workSizeDepth != null and workSizeDepth != ''">
							,#{workSizeDepth}
						</if> 
						<if test="workMatrl != null and workMatrl != ''">
							,#{workMatrl} 
						</if> 
						<if test="workProdcYear != null and workProdcYear != ''">
							,#{workProdcYear} 
						</if> 
						<if test="workVideoUrl != null and workVideoUrl != ''">
							,#{workVideoUrl}
						</if> 
						<if test="workIntrdc != null and workIntrdc != ''">
							,#{workIntrdc}
						</if> 
						<if test="workMainImgUrl != null and workMainImgUrl != ''">
							,#{workMainImgUrl}
						</if>
						<if test="workImgRerUrl != null and workImgRerUrl != ''">
							,#{workImgRerUrl}
						</if> 
						<if test="workGrtUrl != null and workGrtUrl != ''">
							,#{workGrtUrl}
						</if>
						<if test="workImgLefUrl != null and workImgLefUrl != ''">
							,#{workImgLefUrl}
						</if>
						<if test="workImgRitUrl != null and workImgRitUrl != ''">
							,#{workImgRitUrl}
						</if>
						<if test="workImgTopUrl != null and workImgTopUrl != ''">
							,#{workImgTopUrl}
						</if>
						<if test="workImgBotUrl != null and workImgBotUrl != ''">
							,#{workImgBotUrl}
						</if>
						<if test="workLake != null and workLake != ''">
							,#{workLake}
						</if>
						<if test="workState != null and workState != ''">
							,#{workState}
						</if>
						,#{workOpenYn}
				)
				
	</insert>
	
	<insert id="keywrdReg">
		/*작품 키워드 등록*/
		INSERT INTO
					TBL_DA_KEYWRD_S (
						KEYWRD,
						WORK_SQ
					)
					VALUE(
						#{keywrd},
						(
							SELECT
									WORK_SQ
							FROM
									TBL_DA_WORK_M
							WHERE
									ARTST_ACTVTY_NM = #{artstActvtyNm}
							AND 	WORK_NM = #{workNm}
							AND		WORK_FRM_YN = #{workFrmYn}
							AND 	WORK_CLR_CD = #{workClrCd}
							AND 	WORK_TYP_CD = #{workTypCd}
							AND		WORK_IMG_FRT_URL = #{workImgFrtUrl}
						)
										
					)
					
	</insert>
	
	<insert id="myWorkReg">
		/*나의 작품 등록*/
		INSERT INTO 
					TBL_DA_WORK_M(
									MBR_SQ,
									ARTST_SQ,
									ARTST_ACTVTY_NM,
									ARTST_BIRTH_YEAR,
									WORK_TYP_CD,
									WORK_NM,
									WORK_SIZE_WIDTH,
									WORK_SIZE_DEPTH,
									WORK_LAKE,
									WORK_MATRL,
									WORK_PRODC_YEAR,
									WORK_IMG_FRT_URL,
									WORK_FRM_YN,
									WORK_SALE_YN,
									WORK_CLR_CD,
									WORK_SHP_CD,
									WORK_CLSFC_CD,
									REG_DT,
									REG_MBR_SQ,
									UPDT_DT,
									UPDT_MBR_SQ
									<if test="workMainImgUrl != null and workMainImgUrl != ''">
										,WORK_MAIN_IMG_URL
									</if>
									<if test="workImgRerUrl != null and workImgRerUrl != ''">
										,WORK_IMG_RER_URL
									</if> 
									<if test="workGrtUrl != null and workGrtUrl != ''">
										,WORK_GRT_URL
									</if>
									<if test="workPrc != null and workPrc != ''">
										,WORK_PRC
									</if>
									<if test="workImgLefUrl != null and workImgLefUrl != ''">
										,WORK_IMG_LEF_URL
									</if>
									<if test="workImgRitUrl != null and workImgRitUrl != ''">
										,WORK_IMG_RIT_URL
									</if>
									<if test="workImgTopUrl != null and workImgTopUrl != ''">
										,WORK_IMG_TOP_URL
									</if>
									<if test="workImgBotUrl != null and workImgBotUrl != ''">
										,WORK_IMG_BOT_URL
									</if>
									<if test="workVideoUrl != null and workVideoUrl != ''">
										,WORK_VIDEO_URL
									</if>
									<if test="workIntrdc != null and workIntrdc != ''">
										,WORK_INTRDC
									</if>
									<if test="workState != null and workState != ''">
										,WORK_STATE
									</if>
									,WORK_OPEN_YN
					)
					VALUE(
							#{mbrSq},
							#{artstSq},
							#{artstActvtyNm},
							#{artstBirthYear},
							#{workTypCd},
							#{workNm},
							#{workSizeWidth},
							#{workSizeDepth},
							#{workLake},
							#{workMatrl},
							#{workProdcYear},
							#{workImgFrtUrl},
							#{workFrmYn},
							#{workSaleYn},
							#{workClrCd},
							#{workShpCd},
							#{workClsfcCd},
							NOW(),
							#{mbrSq},
							NOW(),
							#{mbrSq}
							<if test="workMainImgUrl != null and workMainImgUrl != ''">
								,#{workMainImgUrl}
							</if>
							<if test="workImgRerUrl != null and workImgRerUrl != ''">
								,#{workImgRerUrl}
							</if> 
							<if test="workGrtUrl != null and workGrtUrl != ''">
								,#{workGrtUrl}
							</if>
							<if test="workPrc != null and workPrc != ''">
								,#{workPrc}
							</if>
							<if test="workImgLefUrl != null and workImgLefUrl != ''">
								,#{workImgLefUrl}
							</if>
							<if test="workImgRitUrl != null and workImgRitUrl != ''">
								,#{workImgRitUrl}
							</if>
							<if test="workImgTopUrl != null and workImgTopUrl != ''">
								,#{workImgTopUrl}
							</if>
							<if test="workImgBotUrl != null and workImgBotUrl != ''">
								,#{workImgBotUrl}
							</if>
							<if test="workVideoUrl != null and workVideoUrl != ''">
								,#{workVideoUrl}
							</if>
							<if test="workIntrdc != null and workIntrdc != ''">
								,#{workIntrdc}
							</if>
							<if test="workState != null and workState != ''">
								,#{workState}
							</if>
							,#{workOpenYn}
					)
					
	</insert>
	<select id="myWorkListSale" resultType="hashMap" parameterType="String">
		/*나의 작품 판매중 검색*/
		SELECT 
				D.DEAL_SQ AS dealSq, /*거래 번호*/
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				B.AUTH_SQ AS authSq, /*작가구분*/
				C.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				C.ARTST_ENGLS_NM AS artstEnglsNm, /*작가영문명*/
				YEAR (B.MBR_BIRTH) AS artstBirthYear, /*작가생년월일*/
				C.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl, /*작가프로필사진주소*/
				D.DEAL_TYP_CD AS dealTypCd, /*거래유형*/
				D.DEAL_STTS_CD AS dealSttsCd, /*거래상태*/
				A.WORK_NM AS workNm, /*작품명*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_HEIGHT AS workSizeHeight, /*작품사이즈높이*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				(SELECT MAX(FORMAT(BID_PRC, 0))
				FROM TBL_DA_AUCTN_BID_H
				WHERE D.DEAL_SQ = DEAL_SQ) AS maxBidPrc, /*응찰가*/
				FORMAT(D.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*거래시작가격*/
				FORMAT(D.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*거래낙찰가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE D.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				DATE_FORMAT(D.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(D.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				D.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		INNER JOIN
				TBL_DA_ARTST_M AS C
			ON 	A.ARTST_SQ = C.ARTST_SQ 
		INNER JOIN 
				TBL_DA_DEAL_M AS D
			ON 	A.WORK_SQ = D.WORK_SQ 
		WHERE
				A.WORK_TYP_CD = 'WORK'
				AND D.DEAL_STTS_CD != 'FB'
				AND A.ARTST_SQ = #{value}
				AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
	</select>
	<select id="myWorkListNonSale" resultType="hashMap" parameterType="hashMap">
		/*나의 작품 판매중 아닌 것 검색*/
		SELECT 
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				B.AUTH_SQ AS authSq, /*작가구분*/
				C.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				C.ARTST_ENGLS_NM AS artstEnglsNm, /*작가영문명*/
				YEAR (B.MBR_BIRTH) AS artstBirthYear, /*작가생년월일*/
				C.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl, /*작가프로필사진주소*/
				A.WORK_NM AS workNm, /*작품명*/
				FORMAT(A.WORK_PRC, 0) AS workPrc, /*작품가격*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear /*작품제작년도*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		INNER JOIN
				TBL_DA_ARTST_M AS C
			ON 	A.ARTST_SQ = C.ARTST_SQ 
		WHERE 
				A.WORK_TYP_CD = 'WORK'
				AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
				<if test="workSq.size != 0 and workSq != null">
					AND A.WORK_SQ NOT IN
					<foreach collection="workSq" item="item" index="idex"  open="(" close=")" separator=",">
			        	#{item}
			        </foreach>
        		</if>
				AND A.ARTST_SQ = #{artstSq}
	</select>
	
	<select id="myWorkMod" resultType="hashMap" parameterType="String">
		/*나의 작품 정보*/
		SELECT 
				A.WORK_SQ AS workSq,
				A.WORK_NM AS workNm,
				A.ARTST_SQ AS artstSq,
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.ARTST_ENGLS_NM AS artstEnglsNm,
				A.ARTST_BIRTH_YEAR AS artstBirthYear,
				A.WORK_TYP_CD AS workTypCd,
				A.WORK_SHP_CD AS workShpCd,
				A.WORK_CLSFC_CD AS workClsfcCd,
				A.WORK_SIZE_WIDTH AS workSizeWidth,
				A.WORK_SIZE_DEPTH AS workSizeDepth,
				A.WORK_LAKE AS workLake,
				A.WORK_MATRL AS workMatrl,
				A.WORK_PRODC_YEAR AS workProdcYear,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_IMG_FRT_URL AS workImgFrtUrl,
				A.WORK_IMG_RER_URL AS workImgRerUrl,
				A.WORK_FRM_YN AS workFrmYn,
				A.WORK_SALE_YN AS workSaleYn,
				A.WORK_CLR_CD AS workClrCd,
				A.WORK_GRT_URL AS workGrtUrl,
				FORMAT(A.WORK_PRC, 0) AS workPrc,
				A.WORK_IMG_LEF_URL AS workImgLefUrl,
				A.WORK_IMG_RIT_URL AS workImgRitUrl,
				A.WORK_IMG_TOP_URL AS workImgTopUrl,
				A.WORK_IMG_BOT_URL AS workImgBotUrl,
				A.WORK_VIDEO_URL AS workVideoUrl,
				A.WORK_INTRDC AS workIntrdc,
				(SELECT B.KEYWRD_SQ FROM TBL_DA_KEYWRD_S AS B WHERE A.WORK_SQ = B.WORK_SQ) AS keywrdSq,
				(SELECT B.KEYWRD FROM TBL_DA_KEYWRD_S AS B WHERE A.WORK_SQ = B.WORK_SQ) AS keywrd,
				A.WORK_OPEN_YN AS workOpenYn,
				A.WORK_STATE AS workState
				 
		FROM 
				TBL_DA_WORK_M AS A
				
		WHERE 
				A.WORK_SQ = #{value}
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			<!-- AND A.WORK_TYP_CD = 'WORK' -->
	</select>
	
	<insert id="myWorkCor">
		/*나의 작품 등록 수정*/
		INSERT INTO 
					TBL_DA_WORK_M(
									WORK_SQ
									,MBR_SQ
									,ARTST_ACTVTY_NM
									,WORK_TYP_CD
									,WORK_NM
									,WORK_SIZE_WIDTH
									,WORK_SIZE_DEPTH
									,WORK_MATRL
									,WORK_PRODC_YEAR
									,WORK_IMG_FRT_URL
									,WORK_FRM_YN
									,WORK_SALE_YN
									,UPDT_DT
									,UPDT_MBR_SQ
									<if test="artstSq != null and artstSq != ''">
										,ARTST_SQ
									</if>
									<if test="artstBirthYear != null and artstBirthYear != ''">
										,ARTST_BIRTH_YEAR
									</if>
									<if test="workLake != null and workLake != ''">
										,WORK_LAKE
									</if>
									<if test="workClrCd != null and workClrCd != ''">
										,WORK_CLR_CD
									</if>
									<if test="workShpCd != null and workShpCd != ''">
										,WORK_SHP_CD
									</if>
									<if test="workClsfcCd != null and workClsfcCd != ''">
										,WORK_CLSFC_CD
									</if>
									<if test="workMainImgUrl != null and workMainImgUrl != ''">
										,WORK_MAIN_IMG_URL
									</if>
									<if test="workImgRerUrl != null and workImgRerUrl != ''">
										,WORK_IMG_RER_URL
									</if> 
									<if test="workGrtUrl != null and workGrtUrl != ''">
										,WORK_GRT_URL
									</if>
									<if test="workPrc != null and workPrc != ''">
										,WORK_PRC
									</if>
									<if test="workImgLefUrl != null and workImgLefUrl != ''">
										,WORK_IMG_LEF_URL
									</if>
									<if test="workImgRitUrl != null and workImgRitUrl != ''">
										,WORK_IMG_RIT_URL
									</if>
									<if test="workImgTopUrl != null and workImgTopUrl != ''">
										,WORK_IMG_TOP_URL
									</if>
									<if test="workImgBotUrl != null and workImgBotUrl != ''">
										,WORK_IMG_BOT_URL
									</if>
									<if test="workVideoUrl != null and workVideoUrl != ''">
										,WORK_VIDEO_URL
									</if>
									<if test="workIntrdc != null and workIntrdc != ''">
										,WORK_INTRDC
									</if>
									<if test="workState != null and workState != ''">
										,WORK_STATE
									</if>
									,WORK_OPEN_YN
					) VALUES (
								#{workSq}
			     				,#{mbrSq}
								,#{artstActvtyNm}
								,#{workTypCd}
								,#{workNm}
								,#{workSizeWidth}
								,#{workSizeDepth}
								,#{workMatrl}
								,#{workProdcYear}
								,#{workImgFrtUrl}
								,#{workFrmYn}
								,#{workSaleYn}
								,NOW()
								,#{mbrSq}
								
								<if test="artstSq != null and artstSq != ''">
									,#{artstSq}
								</if>
								<if test="artstBirthYear != null and artstBirthYear != ''">
									,#{artstBirthYear}
								</if>
								<if test="workLake != null and workLake != ''">
									,#{workLake}
								</if>
								<if test="workClrCd != null and workClrCd != ''">
									,#{workClrCd}
								</if>
								<if test="workShpCd != null and workShpCd != ''">
									,#{workShpCd}
								</if>
								<if test="workClsfcCd != null and workClsfcCd != ''">
									,#{workClsfcCd}
								</if>
								<if test="workMainImgUrl != null and workMainImgUrl != ''">
									,#{workMainImgUrl}
								</if>
								<if test="workImgRerUrl != null and workImgRerUrl != ''">
									,#{workImgRerUrl}
								</if> 
								<if test="workGrtUrl != null and workGrtUrl != ''">
									,#{workGrtUrl}
								</if>
								<if test="workPrc != null and workPrc != ''">
									,#{workPrc}
								</if>
								<if test="workImgLefUrl != null and workImgLefUrl != ''">
									,#{workImgLefUrl}
								</if>
								<if test="workImgRitUrl != null and workImgRitUrl != ''">
									,#{workImgRitUrl}
								</if>
								<if test="workImgTopUrl != null and workImgTopUrl != ''">
									,#{workImgTopUrl}
								</if>
								<if test="workImgBotUrl != null and workImgBotUrl != ''">
									,#{workImgBotUrl}
								</if>
								<if test="workVideoUrl != null and workVideoUrl != ''">
									,#{workVideoUrl}
								</if>
								<if test="workIntrdc != null and workIntrdc != ''">
									,#{workIntrdc}
								</if>
								<if test="workState != null and workState != ''">
									,#{workState}
								</if>
								,#{workOpenYn}
							)
	ON DUPLICATE KEY UPDATE
		    					MBR_SQ = #{mbrSq}
								,ARTST_ACTVTY_NM = #{artstActvtyNm}
								,WORK_TYP_CD = #{workTypCd}
								,WORK_NM = #{workNm}
								,WORK_SIZE_WIDTH = #{workSizeWidth}
								,WORK_SIZE_DEPTH = #{workSizeDepth}
								,WORK_MATRL = #{workMatrl}
								,WORK_PRODC_YEAR = #{workProdcYear}
								,WORK_IMG_FRT_URL = #{workImgFrtUrl}
								,WORK_FRM_YN = #{workFrmYn}
								,WORK_SALE_YN = #{workSaleYn}
								,UPDT_DT = NOW()
								,UPDT_MBR_SQ = #{mbrSq}
								<if test="artstSq != null and artstSq != ''">
									,ARTST_SQ = #{artstSq}
								</if>
								<if test="artstBirthYear != null and artstBirthYear != ''">
									,ARTST_BIRTH_YEAR = #{artstBirthYear}
								</if>
								<if test="workLake != null and workLake != ''">
									,WORK_LAKE = #{workLake}
								</if>
								<if test="workClrCd != null and workClrCd != ''">
									,WORK_CLR_CD = #{workClrCd}
								</if>
								<if test="workShpCd != null and workShpCd != ''">
									,WORK_SHP_CD = #{workShpCd}
								</if>
								<if test="workClsfcCd != null and workClsfcCd != ''">
									,WORK_CLSFC_CD = #{workClsfcCd}
								</if>
								<if test="workMainImgUrl != null and workMainImgUrl != ''">
									,WORK_MAIN_IMG_URL = #{workMainImgUrl}
								</if>
								<if test="workImgRerUrl != null and workImgRerUrl != ''">
									,WORK_IMG_RER_URL = #{workImgRerUrl}
								</if>
								<if test="workGrtUrl != null and workGrtUrl != ''">
									,WORK_GRT_URL = #{workGrtUrl}
								</if>
								<if test="workPrc != null and workPrc != ''">
									,WORK_PRC = #{workPrc}
								</if>
								<if test="workImgLefUrl != null and workImgLefUrl != ''">
									,WORK_IMG_LEF_URL = #{workImgLefUrl}
								</if>
								<if test="workImgRitUrl != null and workImgRitUrl != ''">
									,WORK_IMG_RIT_URL = #{workImgRitUrl}
								</if>
								<if test="workImgTopUrl != null and workImgTopUrl != ''">
									,WORK_IMG_TOP_URL = #{workImgTopUrl}
								</if>
								<if test="workImgBotUrl != null and workImgBotUrl != ''">
									,WORK_IMG_BOT_URL = #{workImgBotUrl}
								</if>
								<if test="workVideoUrl != null and workVideoUrl != ''">
									,WORK_VIDEO_URL = #{workVideoUrl}
								</if>
								<if test="workIntrdc != null and workIntrdc != ''">
									,WORK_INTRDC = #{workIntrdc}
								</if>
								<if test="workState != null and workState != ''">
									,WORK_STATE = #{workState}
								</if>
								,WORK_OPEN_YN = #{workOpenYn}
	</insert>
	
	<insert id="keywrdCor">
		/*작품 키워드 등록*/
		INSERT INTO
					TBL_DA_KEYWRD_S (
									KEYWRD_SQ,
									KEYWRD,
									WORK_SQ
									)
					VALUE(
									#{keywrdSq},
									#{keywrd},
									#{workSq}	
									)
		ON DUPLICATE KEY UPDATE			
									KEYWRD = #{keywrd}
	</insert>
	
	<select id="myCollectionSale" resultType="hashMap" parameterType="String">
		/*나의 소장품 판매중 검색*/
		SELECT 
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				B.AUTH_SQ AS authSq, /*작가구분*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				A.ARTST_ENGLS_NM AS artstEnglsNm, /*작가영문명*/
				A.ARTST_BIRTH_YEAR AS artstBirthYear, /*작가생년월일*/
				C.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl, /*작가프로필사진주소*/
				D.DEAL_TYP_CD AS dealTypCd, /*거래유형*/
				D.DEAL_STTS_CD AS dealSttsCd, /*거래상태*/
				A.WORK_NM AS workNm, /*작품명*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_HEIGHT AS workSizeHeight, /*작품사이즈높이*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				(SELECT MAX(FORMAT(BID_PRC, 0))
				FROM TBL_DA_AUCTN_BID_H
				WHERE D.DEAL_SQ = DEAL_SQ) AS maxBidPrc, /*응찰가*/
				FORMAT(D.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*거래시작가격*/
				FORMAT(D.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*거래낙찰가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE D.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				DATE_FORMAT(D.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(D.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				D.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		LEFT JOIN
				TBL_DA_ARTST_M AS C
			ON 	A.ARTST_SQ = C.ARTST_SQ 
		INNER JOIN 
				TBL_DA_DEAL_M AS D
			ON 	A.WORK_SQ = D.WORK_SQ 
		WHERE
				A.WORK_TYP_CD = 'COLL'
				AND D.DEAL_STTS_CD != 'FB'
				AND A.MBR_SQ = #{mbrSq}
				AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
	</select>
	<select id="myCollectionNonSale" resultType="hashMap" parameterType="String">
		/*나의 소장품 판매전 검색*/
		SELECT 
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				A.ARTST_BIRTH_YEAR AS artstBirthYear, /*작가생년월일*/
				B.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl,
				A.WORK_NM AS workNm, /*작품명*/
				FORMAT(A.WORK_PRC, 0) AS workPrc, /*작품가격*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear /*작품제작년도*/
		FROM 
				TBL_DA_WORK_M AS A
		LEFT JOIN
				TBL_DA_ARTST_M AS B
			ON	A.ARTST_SQ = B.ARTST_SQ
		WHERE 
				A.WORK_TYP_CD = 'COLL' AND
				A.DEL_YN = 'N' /* 작품 삭제 여부 확인 */
				<if test="workSq.size != 0 and workSq != null">
					AND A.WORK_SQ NOT IN
					<foreach collection="workSq" item="item" index="idex"  open="(" close=")" separator=",">
			        	#{item}
			        </foreach>
        		</if>
				AND A.MBR_SQ = #{mbrSq}
	</select>
	<select id="myCollectionMod" resultType="hashMap" parameterType="String">
		/*나의 소장품 정보*/
		SELECT 
				A.WORK_SQ AS workSq,
				A.WORK_NM AS workNm,
				A.WORK_TYP_CD AS workTypCd,
				A.WORK_SHP_CD AS workShpCd,
				A.WORK_CLSFC_CD AS workClsfcCd,
				A.ARTST_SQ AS artstSq,
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.ARTST_ENGLS_NM AS artstEnglsNm,
				A.ARTST_BIRTH_YEAR AS artstBirthYear,
				A.WORK_SIZE_WIDTH AS workSizeWidth,
				A.WORK_SIZE_DEPTH AS workSizeDepth,
				A.WORK_LAKE AS workLake,
				A.WORK_MATRL AS workMatrl,
				A.WORK_PRODC_YEAR AS workProdcYear,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_IMG_FRT_URL AS workImgFrtUrl,
				A.WORK_IMG_RER_URL AS workImgRerUrl,
				A.WORK_FRM_YN AS workFrmYn,
				A.WORK_SALE_YN AS workSaleYn,
				A.WORK_CLR_CD AS workClrCd,
				A.WORK_GRT_URL AS workGrtUrl,
				FORMAT(A.WORK_PRC, 0) AS workPrc,
				A.WORK_IMG_LEF_URL AS workImgLefUrl,
				A.WORK_IMG_RIT_URL AS workImgRitUrl,
				A.WORK_IMG_TOP_URL AS workImgTopUrl,
				A.WORK_IMG_BOT_URL AS workImgBotUrl,
				A.WORK_VIDEO_URL AS workVideoUrl,
				A.WORK_INTRDC AS workIntrdc,
				(SELECT B.KEYWRD_SQ  
				 FROM TBL_DA_KEYWRD_S AS B
				 WHERE A.WORK_SQ = B.WORK_SQ) AS keywrdSq,
				(SELECT B.KEYWRD
				 FROM TBL_DA_KEYWRD_S AS B
				 WHERE A.WORK_SQ = B.WORK_SQ) AS keywrd,
				A.WORK_OPEN_YN AS workOpenYn,
				A.WORK_STATE AS workState
		FROM 
				TBL_DA_WORK_M AS A
				
		WHERE 
				A.WORK_SQ = #{value}
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
			<!-- AND A.WORK_TYP_CD = 'COLL' -->
	</select>
	
	<insert id="collectionCor">
		/*소장품 수정*/
		INSERT INTO 
					TBL_DA_WORK_M (
									WORK_SQ,
									MBR_SQ,
									WORK_TYP_CD,
									ARTST_ACTVTY_NM,
									WORK_NM,
									WORK_FRM_YN,
									WORK_CLR_CD,
									WORK_SHP_CD,
									WORK_CLSFC_CD,
									WORK_IMG_FRT_URL, 
									UPDT_DT,
									UPDT_MBR_SQ
									<if test="artstEnglsNm != null and artstEnglsNm != ''">
										,ARTST_ENGLS_NM
									</if>
									<if test="artstSq != null and artstSq != ''">
										,ARTST_SQ
									</if>
									<if test="artstBirthYear != null and artstBirthYear != ''">
										,ARTST_BIRTH_YEAR
									</if> 
									<if test="workPrc != null and workPrc != ''">
										,WORK_PRC
									</if> 
									<if test="workSizeWidth != null and workSizeWidth != ''">
										,WORK_SIZE_WIDTH
									</if> 
									<if test="workSizeDepth != null and workSizeDepth != ''">
										,WORK_SIZE_DEPTH
									</if> 
									<if test="workMatrl != null and workMatrl != ''">
										,WORK_MATRL 
									</if> 
									<if test="workProdcYear != null and workProdcYear != ''">
										,WORK_PRODC_YEAR 
									</if> 
									<if test="workVideoUrl != null and workVideoUrl != ''">
										,WORK_VIDEO_URL
									</if> 
									<if test="workIntrdc != null and workIntrdc != ''">
										,WORK_INTRDC
									</if> 
									<if test="workMainImgUrl != null and workMainImgUrl != ''">
										,WORK_MAIN_IMG_URL
									</if>
									<if test="workImgRerUrl != null and workImgRerUrl != ''">
										,WORK_IMG_RER_URL
									</if> 
									<if test="workGrtUrl != null and workGrtUrl != ''">
										,WORK_GRT_URL
									</if>
									<if test="workImgLefUrl != null and workImgLefUrl != ''">
										,WORK_IMG_LEF_URL
									</if>
									<if test="workImgRitUrl != null and workImgRitUrl != ''">
										,WORK_IMG_RIT_URL
									</if>
									<if test="workImgTopUrl != null and workImgTopUrl != ''">
										,WORK_IMG_TOP_URL
									</if>
									<if test="workImgBotUrl != null and workImgBotUrl != ''">
										,WORK_IMG_BOT_URL
									</if>
									<if test="workLake != null and workLake != ''">
										,WORK_LAKE
									</if>
									<if test="workState != null and workState != ''">
										,WORK_STATE
									</if>
									,WORK_OPEN_YN
								)
							VALUES (
									#{workSq},
									#{mbrSq}, 
									#{workTypCd}, 
									#{artstActvtyNm}, 
									#{workNm}, 
									#{workFrmYn}, 
									#{workClrCd},
									#{workShpCd},
									#{workClsfcCd},
									#{workImgFrtUrl}, 
									NOW(),
									#{mbrSq}
									<if test="artstEnglsNm != null and artstEnglsNm != ''">
										,#{artstEnglsNm}
									</if>
									<if test="artstSq != null and artstSq != ''">
										,#{artstSq}
									</if>
									<if test="artstBirthYear != null and artstBirthYear != ''">
										,#{artstBirthYear}
									</if> 
									<if test="workPrc != null and workPrc != ''">
										,#{workPrc}
									</if> 
									<if test="workSizeWidth != null and workSizeWidth != ''">
										,#{workSizeWidth}
									</if> 
									<if test="workSizeDepth != null and workSizeDepth != ''">
										,#{workSizeDepth}
									</if> 
									<if test="workMatrl != null and workMatrl != ''">
										,#{workMatrl} 
									</if> 
									<if test="workProdcYear != null and workProdcYear != ''">
										,#{workProdcYear} 
									</if> 
									<if test="workVideoUrl  != null and workVideoUrl  != ''">
										,#{workVideoUrl}
									</if> 
									<if test="workIntrdc != null and workIntrdc != ''">
										,#{workIntrdc}
									</if> 
									<if test="workMainImgUrl != null and workMainImgUrl != ''">
										,#{workMainImgUrl}
									</if>
									<if test="workImgRerUrl != null and workImgRerUrl != ''">
										,#{workImgRerUrl}
									</if> 
									<if test="workGrtUrl != null and workGrtUrl != ''">
										,#{workGrtUrl}
									</if>
									<if test="workImgLefUrl != null and workImgLefUrl != ''">
										,#{workImgLefUrl}
									</if>
									<if test="workImgRitUrl != null and workImgRitUrl != ''">
										,#{workImgRitUrl}
									</if>
									<if test="workImgTopUrl != null and workImgTopUrl != ''">
										,#{workImgTopUrl}
									</if>
									<if test="workImgBotUrl != null and workImgBotUrl != ''">
										,#{workImgBotUrl}
									</if>
									<if test="workLake != null and workLake != ''">
										,#{workLake}
									</if>
									<if test="workState != null and workState != ''">
										,#{workState}
									</if>
									,#{workOpenYn}
							)
	ON DUPLICATE KEY UPDATE
								WORK_TYP_CD = #{workTypCd}, 
								ARTST_ACTVTY_NM = #{artstActvtyNm}, 
								WORK_NM = #{workNm},
								WORK_FRM_YN = #{workFrmYn},
								WORK_CLR_CD = #{workClrCd},
								WORK_SHP_CD = #{workShpCd},
								WORK_CLSFC_CD = #{workClsfcCd},
								WORK_IMG_FRT_URL = #{workImgFrtUrl},
								UPDT_DT = NOW(),
								UPDT_MBR_SQ = #{mbrSq}
								<if test="artstEnglsNm != null and artstEnglsNm != ''">
									,ARTST_ENGLS_NM = #{artstEnglsNm}
								</if>
								<if test="artstSq != null and artstSq != ''">
									,ARTST_SQ = #{artstSq}
								</if>
								<if test="artstBirthYear != null and artstBirthYear != ''">
									,ARTST_BIRTH_YEAR = #{artstBirthYear}
								</if> 
								<if test="workPrc != null and workPrc != ''">
									,WORK_PRC = #{workPrc}
								</if> 
								<if test="workSizeWidth != null and workSizeWidth != ''">
									,WORK_SIZE_WIDTH = #{workSizeWidth}
								</if> 
								<if test="workSizeDepth != null and workSizeDepth != ''">
									,WORK_SIZE_DEPTH = #{workSizeDepth}
								</if> 
								<if test="workMatrl != null and workMatrl != ''">
									,WORK_MATRL = #{workMatrl}
								</if> 
								<if test="workProdcYear != null and workProdcYear != ''">
									,WORK_PRODC_YEAR = #{workProdcYear}
								</if> 
								<if test="workVideoUrl  != null and workVideoUrl  != ''">
									,WORK_VIDEO_URL = #{workVideoUrl}
								</if> 
								<if test="workIntrdc != null and workIntrdc != ''">
									,WORK_INTRDC = #{workIntrdc}
								</if> 
								<if test="workMainImgUrl != null and workMainImgUrl != ''">
									,WORK_MAIN_IMG_URL = #{workMainImgUrl}
								</if>
								<if test="workImgRerUrl != null and workImgRerUrl != ''">
									,WORK_IMG_RER_URL = #{workImgRerUrl}
								</if>
								<if test="workGrtUrl != null and workGrtUrl != ''">
									,WORK_GRT_URL = #{workGrtUrl}
								</if>
								<if test="workImgLefUrl != null and workImgLefUrl != ''">
									,WORK_IMG_LEF_URL = #{workImgLefUrl}
								</if>
								<if test="workImgRitUrl != null and workImgRitUrl != ''">
									,WORK_IMG_RIT_URL = #{workImgRitUrl}
								</if>
								<if test="workImgTopUrl != null and workImgTopUrl != ''">
									,WORK_IMG_TOP_URL = #{workImgTopUrl}
								</if>
								<if test="workImgBotUrl != null and workImgBotUrl != ''">
									,WORK_IMG_BOT_URL = #{workImgBotUrl}
								</if>
								<if test="workLake != null and workLake != ''">
									,WORK_LAKE = #{workLake}
								</if>
								<if test="workState != null and workState != ''">
									,WORK_STATE = #{workState}
								</if>
								,WORK_OPEN_YN = #{workOpenYn}
	</insert>
	
	<select id="scrapList" resultType="hashMap" parameterType="String">
		/*스크랩한 작품 번호 조회*/
		SELECT 
				WORK_SQ AS workSq
		FROM 
				TBL_DA_MBR_SCRAP_R
		WHERE 
				MBR_SQ = #{value}
	</select>
		
	<select id="scrapListSale" resultType="hashMap" parameterType="hashMap">
		/*판매중인 스크랩 목록 조회*/
		SELECT 
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				B.AUTH_SQ AS authSq, /*작가구분*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				YEAR (B.MBR_BIRTH) AS artstBirthYear, /*작가생년월일*/
				C.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl, /*작가프로필사진주소*/
				D.DEAL_TYP_CD AS dealTypCd, /*거래유형*/
				D.DEAL_STTS_CD AS dealSttsCd, /*거래상태*/
				A.WORK_NM AS workNm, /*작품명*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_HEIGHT AS workSizeHeight, /*작품사이즈높이*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				(SELECT MAX(FORMAT(BID_PRC, 0))
				FROM TBL_DA_AUCTN_BID_H
				WHERE D.DEAL_SQ = DEAL_SQ) AS maxBidPrc, /*응찰가*/
				FORMAT(D.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*거래시작가격*/
				FORMAT(D.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*거래낙찰가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE D.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				DATE_FORMAT(D.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(D.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				D.DEAL_ENDNG_DT AS dealEndngDateTime /*거래종료날짜시간*/
		FROM 
				TBL_DA_WORK_M AS A
		INNER JOIN
				TBL_DA_MBR_M AS B
			ON	A.MBR_SQ = B.MBR_SQ
		INNER JOIN
				TBL_DA_ARTST_M AS C
			ON 	A.ARTST_SQ = C.ARTST_SQ 
		INNER JOIN 
				TBL_DA_DEAL_M AS D
			ON 	A.WORK_SQ = D.WORK_SQ 
		WHERE 1=1
				AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */	
				AND A.WORK_SQ IN
			
				<foreach collection="list" item="item" index="idex"  open="(" close=")" separator=",">
		        	#{item.workSq}
		        </foreach>
	</select>
	<select id="scrapListNonSale" resultType="hashMap" parameterType="hashMap">
		/*판매중이 아닌 스크랩 목록 조회*/
		SELECT 
				A.WORK_SQ AS workSq, /*작품번호*/
				A.MBR_SQ AS mbrSq, /*멤버번호*/
				A.ARTST_SQ AS artstSq, /*작가번호*/
				D.AUTH_SQ AS authSq, /*작가구분*/
				C.ARTST_PROFILE_IMG_URL AS artstProfileImgUrl, /*작가프로필사진주소*/
				A.ARTST_ACTVTY_NM AS artstActvtyNm, /*작가활동명*/
				A.ARTST_BIRTH_YEAR AS artstBirthYear, /*작가생년월일*/
				A.WORK_NM AS workNm, /*작품명*/
				FORMAT(A.WORK_PRC, 0) AS workPrc, /*작품가격*/
				A.WORK_PRODC_YEAR AS workProdcYear, /*작품제작년도*/
				A.WORK_MATRL AS workMatrl, /*작품소재*/
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_SIZE_WIDTH AS workSizeWidth, /*작품사이즈가로*/
				A.WORK_SIZE_DEPTH AS workSizeDepth, /*작품사이즈세로*/
				A.WORK_PRODC_YEAR AS workProdcYear /*작품제작년도*/
		FROM 
				TBL_DA_WORK_M AS A,
				TBL_DA_MBR_M AS D,
				TBL_DA_ARTST_M AS C
		WHERE 
				A.MBR_SQ = D.MBR_SQ 
				AND A.ARTST_SQ = C.ARTST_SQ
				AND A.WORK_SALE_YN = 'N'
				AND A.DEL_YN = 'N' /* 작품 삭제 여부 확인 */
				<if test="workSq.size != 0 and workSq != null">
					AND A.WORK_SQ NOT IN
					<foreach collection="workSq" item="item" index="idex"  open="(" close=")" separator=",">
			        	#{item}
			        </foreach>
        		</if>
        		<if test="scrapSq.size != 0 and scrapSq != null">
					AND A.WORK_SQ IN
					<foreach collection="scrapSq" item="item" index="idex"  open="(" close=")" separator=",">
			        	#{item.workSq}
			        </foreach>
        		</if>
	</select>
	<update id="updateBuyPaymntSttsCd" parameterType="String">
		/*구매 결제상태 변경*/
		UPDATE 
				TBL_DA_DEAL_M 
		SET		
				BUY_PAYMNT_STTS_CD = #{dealSttsCd}
		WHERE  
				DEAL_SQ = #{dealSq}
	</update>
	<update id="updateSellPaymntSttsCd" parameterType="String">
		/*판매 결제상태 변경*/
		UPDATE 
				TBL_DA_DEAL_M 
		SET		
				SELL_PAYMNT_STTS_CD = #{dealSttsCd}
		WHERE  
				DEAL_SQ = #{dealSq}
	</update>
	
	<select id="getPaymentDeliveryInfo" resultType="hashMap" parameterType="String">
		/*결제 구매자/판매자 배송지 조회*/
		SELECT 
				MBR_SQ AS mbrSq,
				MBR_NM AS mbrNm,
				MBR_EMAIL AS mbrEmail,
				MBR_CP_NUM AS mbrCpNum,
				MBR_DELIVRY_ADDR AS mbrDelivryAddr,
				MBR_ACCOUNT_NO AS mbrAccountNo,
				MBR_BANK_CD AS mbrBankCd,
				MBR_BANK_NM AS mbrBankNm
		FROM 
				TBL_DA_MBR_M
		WHERE 
				MBR_SQ = #{mbrSq}
	
	</select>
	
	<select id="getMyDealDetailDealInfoBuy" resultType="hashMap" parameterType="String">
		/*결제 상세 페이지 상품 정보 조회*/
		SELECT 
				B.DEAL_SQ AS dealSq,
				B.SELL_MBR_SQ AS sellMbrSq,
				B.BUY_MBR_SQ AS buyMbrSq,
				A.WORK_SQ AS workSq,
				A.ARTST_SQ AS artstSq,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_GRT_URL AS workGrtUrl,
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.WORK_NM AS workNm,
				A.WORK_PRODC_YEAR AS workProdcYear,
				A.WORK_LAKE AS workLake,
				B.MBR_REF_NO AS mbrRefNo,
				B.DEAL_TYP_CD AS dealTypCd,
				B.DEAL_STTS_CD AS dealSttsCd,
				B.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd,
				B.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd,
				DATE_FORMAT(B.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				FORMAT(B.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*경매 시작가*/
				(SELECT MBR_SQ 
				FROM TBL_DA_AUCTN_BID_H
				WHERE B.DEAL_SQ = DEAL_SQ
				ORDER BY BID_DATE DESC LIMIT 1) AS bidMbrSq, /*마지막 응찰 회원 순번*/
				FORMAT(B.DEAL_AUCTN_PRC, 0) AS dealAuctnPrc, /*경매 응찰 가격*/
				FORMAT(B.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*경매 낙찰 가격*/
				FORMAT(B.DEAL_FINAL_PRC, 0) AS dealFinalPrc, /*거래 최종 가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE B.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				(SELECT
					PAYMETHOD
				FROM
					TBL_DA_PAYMNT_H
				WHERE
				IF (B.BUY_PAYMNT_STTS_CD = '2PW', MBR_SQ = B.BUY_MBR_SQ, 1=1)
				AND DEAL_SQ = #{dealSq}
				AND	PAYMNT_TYP_CD = (CASE
										WHEN B.BUY_PAYMNT_STTS_CD = '1PW' THEN '1'
										WHEN B.BUY_PAYMNT_STTS_CD = '2PW' THEN '2'
										ELSE NULL
									END)
				GROUP BY PAYMNT_SQ
				) AS payMethod /*결제 수단*/
		FROM 
				TBL_DA_WORK_M AS A,
				TBL_DA_DEAL_M AS B
		WHERE 
				 A.WORK_SQ = B.WORK_SQ
			AND B.DEAL_SQ = #{dealSq}
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
		GROUP BY B.DEAL_SQ
	</select>
	
	<select id="getMyDealDetailDealInfoSell" resultType="hashMap" parameterType="String">
		/*결제 상세 페이지 상품 정보 조회*/
		SELECT 
				B.DEAL_SQ AS dealSq,
				B.SELL_MBR_SQ AS sellMbrSq,
				B.BUY_MBR_SQ AS buyMbrSq,
				A.WORK_SQ AS workSq,
				A.ARTST_SQ AS artstSq,
				IF(A.WORK_MAIN_IMG_URL IS NULL, A.WORK_IMG_FRT_URL, A.WORK_MAIN_IMG_URL) AS workMainImgUrl, /*작품대표이미지주소*/
				A.WORK_GRT_URL AS workGrtUrl,
				A.ARTST_ACTVTY_NM AS artstActvtyNm,
				A.WORK_NM AS workNm,
				A.WORK_PRODC_YEAR AS workProdcYear,
				A.WORK_LAKE AS workLake,
				B.MBR_REF_NO AS mbrRefNo,
				B.DEAL_TYP_CD AS dealTypCd,
				B.DEAL_STTS_CD AS dealSttsCd,
				B.BUY_PAYMNT_STTS_CD AS buyPaymntSttsCd,
				B.SELL_PAYMNT_STTS_CD AS sellPaymntSttsCd,
				DATE_FORMAT(B.DEAL_STRT_DT, '%Y.%m.%d %H:%i') AS dealStrtDate, /*거래시작일시*/
				DATE_FORMAT(B.DEAL_ENDNG_DT, '%Y.%m.%d %H:%i') AS dealEndngDate, /*거래종료일시*/
				FORMAT(B.DEAL_STRT_PRC, 0) AS dealStrtPrc, /*경매 시작가*/
				(SELECT MBR_SQ 
				FROM TBL_DA_AUCTN_BID_H
				WHERE B.DEAL_SQ = DEAL_SQ
				ORDER BY BID_DATE DESC LIMIT 1) AS bidMbrSq, /*마지막 응찰 회원 순번*/
				FORMAT(B.DEAL_AUCTN_PRC, 0) AS dealAuctnPrc, /*경매 응찰 가격*/
				FORMAT(B.DEAL_SBID_PRC, 0) AS dealSbidPrc, /*경매 낙찰 가격*/
				FORMAT(B.DEAL_FINAL_PRC, 0) AS dealFinalPrc, /*거래 최종 가격*/
				(SELECT COUNT(DEAL_SQ)
				FROM TBL_DA_AUCTN_BID_H 
				WHERE B.DEAL_SQ = DEAL_SQ) AS bidCnt, /*응찰수*/
				(SELECT
					PAYMETHOD
				FROM
					TBL_DA_PAYMNT_H
				WHERE
					DEAL_SQ = #{dealSq}
				AND MBR_SQ = B.SELL_MBR_SQ
				AND	PAYMNT_TYP_CD = (CASE
										WHEN B.SELL_PAYMNT_STTS_CD = '2PW' THEN '2'
										ELSE NULL
									END)
				GROUP BY PAYMNT_SQ
				) AS payMethod /*결제 수단*/
		FROM 
				TBL_DA_WORK_M AS A,
				TBL_DA_DEAL_M AS B
		WHERE 
				 A.WORK_SQ = B.WORK_SQ
			AND B.DEAL_SQ = #{dealSq}
			AND	A.DEL_YN = 'N' /*작품 삭제 여부 확인 */
		GROUP BY B.DEAL_SQ
	</select>
	
	<select id="selectTrnsprtPrc" resultType="String" parameterType="hashMap">
		/*운송 가격 가져오기*/
		SELECT
				FORMAT(TRNSPRT_PRC , 0)
		FROM
				TBL_DA_TRNSPRT_PRC_MTRX
		WHERE 
				TRNSPRT_DIV_CD = #{trnsprtDivCd}
			<if test="trnsprtTypCd != null and trnsprtTypCd != ''">
			AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
			</if>
			<if test="trnsprtAreaCd != null and trnsprtAreaCd != ''">
			AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			</if>
			<if test="trnsprtServiceCd != null and trnsprtServiceCd != ''">
			AND TRNSPRT_SERVICE_CD = #{trnsprtServiceCd}
			</if>
	</select>
	
	<select id="selectTrnsprtCdNm" resultType="hashMap" parameterType="hashMap">
		/*운송 매트리스 코드 이름 가져오기*/
		SELECT
			(SELECT TRNSPRT_DIV_CD_NM
			FROM TBL_DA_TRNSPRT_PRC_MTRX
			WHERE TRNSPRT_DIV_CD = #{trnsprtDivCd}
			GROUP BY TRNSPRT_DIV_CD_NM) AS trnsprtDivCdNm,
			(SELECT TRNSPRT_TYP_CD_NM 
			FROM TBL_DA_TRNSPRT_PRC_MTRX
			WHERE TRNSPRT_TYP_CD = #{trnsprtTypCd}
			GROUP BY TRNSPRT_TYP_CD_NM) AS trnsprtTypCdNm,
			(SELECT TRNSPRT_AREA_CD_NM 
			FROM TBL_DA_TRNSPRT_PRC_MTRX
			WHERE TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			GROUP BY TRNSPRT_AREA_CD_NM) AS trnsprtAreaCdNm,
			(SELECT TRNSPRT_SERVICE_CD_NM 
			FROM TBL_DA_TRNSPRT_PRC_MTRX
			WHERE TRNSPRT_SERVICE_CD = #{trnsprtServiceCd}
			GROUP BY TRNSPRT_SERVICE_CD_NM) AS trnsprtServiceCdNm
	</select>
	
	<select id="selectTrnsprtInfo" resultType="hashMap" parameterType="hashMap">
		/* 운송 매트리스 코드 텍스트, 가격 조회 */
		SELECT 
				TRNSPRT_SERVICE_CD_NM AS text,
				FORMAT(TRNSPRT_PRC, 0) AS value
		FROM
				TBL_DA_TRNSPRT_PRC_MTRX 
		WHERE 
				TRNSPRT_DIV_CD = #{trnsprtDivCd}
			<if test="trnsprtTypCd != null and trnsprtTypCd != ''">
			AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
			</if>
			<if test="trnsprtAreaCd != null and trnsprtAreaCd != ''">
			AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			</if>
			<if test="trnsprtServiceNm != null and trnsprtServiceNm != ''">
			AND TRNSPRT_SERVICE_NM = #{trnsprtServiceNm}
			</if>
			<if test="trnsprtReqYn != null and trnsprtReqYn != ''">
			AND TRNSPRT_REQ_YN = #{trnsprtReqYn}
			</if>
	</select>
	
	<select id="getTrnsprt" parameterType="hashMap" resultType="hashMap">
		/*운송 테이블에 저장하기 위해 해당 운송 정보 가져오기*/
		SELECT 
				TRNSPRT_DIV_CD AS trnsprtDivCd,
				TRNSPRT_DIV_CD_NM AS trnsprtDivCdNm,
				TRNSPRT_TYP_CD AS trnsprtTypCd,
				TRNSPRT_TYP_CD_NM AS trnsprtTypCdNm,
				TRNSPRT_AREA_CD AS trnsprtAreaCd,
				TRNSPRT_AREA_CD_NM AS trnsprtAreaCdNm,
				TRNSPRT_SERVICE_CD AS trnsprtServiceCd,
				TRNSPRT_SERVICE_CD_NM AS trnsprtServiceCdNm,
				TRNSPRT_PRC AS trnsprtPrc
		FROM 
				TBL_DA_TRNSPRT_PRC_MTRX
		WHERE 
				TRNSPRT_DIV_CD = #{trnsprtDivCd}
			AND	TRNSPRT_SERVICE_CD_NM = #{trnsprtServiceCdNm}
			AND TRNSPRT_PRC = #{trnsprtPrc}
			AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
			<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
			AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			</if>
	</select>
	
	<insert id="insertTrnsprt" parameterType="hashMap">
	/*운송 테이블에 운송 정보 입력*/
	INSERT INTO
				TBL_DA_DEAL_TRNSPRT_S(
					DEAL_SQ
					,BUY_MBR_SQ
					,SELL_MBR_SQ
					,ARTST_SQ
					,TRNSPRT_DIV_CD
					,TRNSPRT_DIV_CD_NM
					,TRNSPRT_TYP_CD
					,TRNSPRT_TYP_CD_NM
					,TRNSPRT_AREA_CD
					,TRNSPRT_AREA_CD_NM
					,TRNSPRT_SERVICE_CD
					,TRNSPRT_SERVICE_CD_NM
					,TRNSPRT_PRC 
				)VALUES
				<foreach collection="list" item="item" index="idex" separator=",">
				(
					#{item.dealSq}
					,#{item.buyMbrSq}
					,#{item.sellMbrSq}
					,#{item.artstSq}
					,#{item.trnsprtDivCd}
					,#{item.trnsprtDivCdNm}
					,#{item.trnsprtTypCd}
					,#{item.trnsprtTypCdNm}
					,#{item.trnsprtAreaCd}
					,#{item.trnsprtAreaCdNm}
					,#{item.trnsprtServiceCd}
					,#{item.trnsprtServiceCdNm}
					,#{item.trnsprtPrc}
				)
				</foreach>
	</insert>
	
	<select id="selectPaymntBuy1" parameterType="hashMap" resultType="hashMap">
		/*결제 내역 정보 가져오기*/
		SELECT 
				(
				CASE
					WHEN A.PAYMETHOD = 'CARD' THEN '신용카드'
					WHEN A.PAYMETHOD = 'VACCT' THEN '가상계좌'
					WHEN A.PAYMETHOD = 'ACCT' THEN '계좌이체'
					WHEN A.PAYMETHOD = 'NONE' THEN '결제완료'
				END 
				) AS payMethod,
				(
				CASE 
					WHEN A.PAY_TYPE IN ('I', 'V', 'K') THEN '신용카드'
					WHEN A.PAY_TYPE = 'A' THEN '카카오페이'
					WHEN A.PAY_TYPE = 'P' THEN '페이코'
					WHEN A.PAY_TYPE IN ('N1', 'N2') THEN '네이버페이'
				END 
				) AS payType,
				(
				CASE 
					WHEN A.BANK_CODE IN ('03', '003') THEN '기업은행'
					WHEN A.BANK_CODE IN ('04', '004') THEN '국민은행'
					WHEN A.BANK_CODE IN ('11', '011') THEN '농협'
					WHEN A.BANK_CODE IN ('20', '020') THEN '우리은행'
					WHEN A.BANK_CODE IN ('26', '088') THEN '신한은행'
					WHEN A.BANK_CODE IN ('32', '032') THEN '부산은행'
					WHEN A.BANK_CODE IN ('71', '071') THEN '우체국'
					WHEN A.BANK_CODE IN ('81', '081') THEN '하나은행'
					WHEN A.BANK_CODE = '005' THEN '외환은행'
					WHEN A.BANK_CODE = '023' THEN '제일은행'
					WHEN A.BANK_CODE = '027' THEN '씨티은행'
					WHEN A.BANK_CODE = '031' THEN '대구은행'
					WHEN A.BANK_CODE = '034' THEN '광주은행'
					WHEN A.BANK_CODE = '037' THEN '전북은행'
					WHEN A.BANK_CODE = '039' THEN '경남은행'
					WHEN A.BANK_CODE = '048' THEN '신협'
					WHEN A.BANK_CODE = '045' THEN '새마을금고'
					WHEN A.BANK_CODE = '035' THEN '제주은행'
					WHEN A.BANK_CODE = '007' THEN '수협'
					WHEN A.BANK_CODE = '002' THEN '산업은행'
				END
				)AS bankName,
				A.ISSUE_COMPANY_NAME AS issueCompanyName, /*카드사*/
				A.CARD_NO AS cardNo, /*카드번호*/
				A.INSTALLMENT AS installment, /*할부개월 수*/
				A.ACCOUNT_NO AS accountNo, /*입금 계좌번호*/
				DATE_FORMAT(A.ACCOUNT_CLOSE_DATE, '%Y-%m-%d') AS accountCloseDate, /*입금 마감일*/
				FORMAT(A.PAYMNT_AMT, 0) AS paymntAmt, /*결제 금액*/
				FORMAT((A.PAYMNT_AMT - A.PAYMNT_FEE_AMT), 0) AS paymntWorkAmt, /*작품 가격*/
				FORMAT(A.PAYMNT_FEE_AMT, 0)AS paymntFeeAmt, /*거래 수수료*/
				FORMAT(A.PAYMNT_DISC_AMT, 0)AS paymntDiscAmt, /*할인 금액*/
				B.CUPON_NM AS cuponNm, /*쿠폰 내용*/
				A.REF_NO AS refNo,
				A.TRAN_DATE AS tranDate
		FROM 
				TBL_DA_PAYMNT_H A
		LEFT JOIN 
				TBL_DA_CUPON_M B
			ON	A.CUPON_SQ = B.CUPON_SQ 
		WHERE 
				A.DEAL_SQ = #{dealSq}
			AND MBR_SQ = #{mbrSq}
			AND A.PAYMNT_TYP_CD = '1'
			AND A.PAYMNT_DIV_CD = 'B'
	</select>
	
	<select id="selectPaymntBuy2" parameterType="hashMap" resultType="hashMap">
		/*결제 내역 정보 가져오기*/
		SELECT 
				(
				CASE
					WHEN A.PAYMETHOD = 'CARD' THEN '신용카드'
					WHEN A.PAYMETHOD = 'VACCT' THEN '가상계좌'
					WHEN A.PAYMETHOD = 'ACCT' THEN '계좌이체'
					WHEN A.PAYMETHOD = 'NONE' THEN '결제완료'
				END 
				) AS payMethod,
				(
				CASE 
					WHEN A.PAY_TYPE IN ('I', 'V', 'K') THEN '신용카드'
					WHEN A.PAY_TYPE = 'A' THEN '카카오페이'
					WHEN A.PAY_TYPE = 'P' THEN '페이코'
					WHEN A.PAY_TYPE IN ('N1', 'N2') THEN '네이버페이'
				END 
				) AS payType,
				(
				CASE 
					WHEN A.BANK_CODE IN ('03', '003') THEN '기업은행'
					WHEN A.BANK_CODE IN ('04', '004') THEN '국민은행'
					WHEN A.BANK_CODE IN ('11', '011') THEN '농협'
					WHEN A.BANK_CODE IN ('20', '020') THEN '우리은행'
					WHEN A.BANK_CODE IN ('26', '088') THEN '신한은행'
					WHEN A.BANK_CODE IN ('32', '032') THEN '부산은행'
					WHEN A.BANK_CODE IN ('71', '071') THEN '우체국'
					WHEN A.BANK_CODE IN ('81', '081') THEN '하나은행'
					WHEN A.BANK_CODE = '005' THEN '외환은행'
					WHEN A.BANK_CODE = '023' THEN '제일은행'
					WHEN A.BANK_CODE = '027' THEN '씨티은행'
					WHEN A.BANK_CODE = '031' THEN '대구은행'
					WHEN A.BANK_CODE = '034' THEN '광주은행'
					WHEN A.BANK_CODE = '037' THEN '전북은행'
					WHEN A.BANK_CODE = '039' THEN '경남은행'
					WHEN A.BANK_CODE = '048' THEN '신협'
					WHEN A.BANK_CODE = '045' THEN '새마을금고'
					WHEN A.BANK_CODE = '035' THEN '제주은행'
					WHEN A.BANK_CODE = '007' THEN '수협'
					WHEN A.BANK_CODE = '002' THEN '산업은행'
				END
				)AS bankName,
				A.ISSUE_COMPANY_NAME AS issueCompanyName, /*카드사*/
				A.CARD_NO AS cardNo, /*카드번호*/
				A.INSTALLMENT AS installment, /*할부개월 수*/
				A.ACCOUNT_NO AS accountNo, /*입금 계좌번호*/
				DATE_FORMAT(A.ACCOUNT_CLOSE_DATE, '%Y-%m-%d') AS accountCloseDate, /*입금 마감일*/
				FORMAT(A.PAYMNT_AMT, 0) AS paymntAmt, /*결제 금액*/
				FORMAT((A.PAYMNT_AMT - A.PAYMNT_FEE_AMT), 0) AS paymntWorkAmt, /*작품 가격*/
				FORMAT(A.PAYMNT_FEE_AMT, 0)AS paymntFeeAmt, /*거래 수수료*/
				FORMAT(A.PAYMNT_DISC_AMT, 0)AS paymntDiscAmt, /*할인 금액*/
				B.CUPON_NM AS cuponNm, /*쿠폰 내용*/
				A.REF_NO AS refNo,
				A.TRAN_DATE AS tranDate
		FROM 
				TBL_DA_PAYMNT_H A
		LEFT JOIN 
				TBL_DA_CUPON_M B
			ON	A.CUPON_SQ = B.CUPON_SQ 
		WHERE 
				A.DEAL_SQ = #{dealSq}
			AND MBR_SQ = #{mbrSq}
			AND A.PAYMNT_TYP_CD = '2'
			AND A.PAYMNT_DIV_CD = 'B'
	</select>
	
	<select id="selectPaymntSell" parameterType="hashMap" resultType="hashMap">
		/*결제 내역 정보 가져오기*/
		SELECT 
				(
				CASE
					WHEN A.PAYMETHOD = 'CARD' THEN '신용카드'
					WHEN A.PAYMETHOD = 'VACCT' THEN '가상계좌'
					WHEN A.PAYMETHOD = 'ACCT' THEN '계좌이체'
					WHEN A.PAYMETHOD = 'NONE' THEN '결제완료'
				END 
				) AS payMethod,
				(
				CASE 
					WHEN A.PAY_TYPE IN ('I', 'V', 'K') THEN '신용카드'
					WHEN A.PAY_TYPE = 'A' THEN '카카오페이'
					WHEN A.PAY_TYPE = 'P' THEN '페이코'
					WHEN A.PAY_TYPE IN ('N1', 'N2') THEN '네이버페이'
				END 
				) AS payType,
				(
				CASE 
					WHEN A.BANK_CODE IN ('03', '003') THEN '기업은행'
					WHEN A.BANK_CODE IN ('04', '004') THEN '국민은행'
					WHEN A.BANK_CODE IN ('11', '011') THEN '농협'
					WHEN A.BANK_CODE IN ('20', '020') THEN '우리은행'
					WHEN A.BANK_CODE IN ('26', '088') THEN '신한은행'
					WHEN A.BANK_CODE IN ('32', '032') THEN '부산은행'
					WHEN A.BANK_CODE IN ('71', '071') THEN '우체국'
					WHEN A.BANK_CODE IN ('81', '081') THEN '하나은행'
					WHEN A.BANK_CODE = '005' THEN '외환은행'
					WHEN A.BANK_CODE = '023' THEN '제일은행'
					WHEN A.BANK_CODE = '027' THEN '씨티은행'
					WHEN A.BANK_CODE = '031' THEN '대구은행'
					WHEN A.BANK_CODE = '034' THEN '광주은행'
					WHEN A.BANK_CODE = '037' THEN '전북은행'
					WHEN A.BANK_CODE = '039' THEN '경남은행'
					WHEN A.BANK_CODE = '048' THEN '신협'
					WHEN A.BANK_CODE = '045' THEN '새마을금고'
					WHEN A.BANK_CODE = '035' THEN '제주은행'
					WHEN A.BANK_CODE = '007' THEN '수협'
					WHEN A.BANK_CODE = '002' THEN '산업은행'
				END
				)AS bankName,
				A.ISSUE_COMPANY_NAME AS issueCompanyName, /*카드사*/
				A.CARD_NO AS cardNo, /*카드번호*/
				A.INSTALLMENT AS installment, /*할부개월 수*/
				A.ACCOUNT_NO AS accountNo, /*입금 계좌번호*/
				DATE_FORMAT(A.ACCOUNT_CLOSE_DATE, '%Y-%m-%d') AS accountCloseDate, /*입금 마감일*/
				FORMAT(A.PAYMNT_AMT, 0) AS paymntAmt, /*결제 금액*/
				FORMAT((A.PAYMNT_AMT - A.PAYMNT_FEE_AMT), 0) AS paymntWorkAmt, /*작품 가격*/
				FORMAT(A.PAYMNT_FEE_AMT, 0)AS paymntFeeAmt, /*거래 수수료*/
				FORMAT(A.PAYMNT_DISC_AMT, 0)AS paymntDiscAmt, /*할인 금액*/
				B.CUPON_NM AS cuponNm, /*쿠폰 내용*/
				A.REF_NO AS refNo,
				A.TRAN_DATE AS tranDate
		FROM 
				TBL_DA_PAYMNT_H A
		LEFT JOIN 
				TBL_DA_CUPON_M B
			ON	A.CUPON_SQ = B.CUPON_SQ 
		WHERE 
				A.DEAL_SQ = #{dealSq}
			AND MBR_SQ = #{mbrSq}
			AND A.PAYMNT_DIV_CD = 'S'
	</select>
	<select id="selectTrnsprtInfoBuy" resultType="hashMap" parameterType="hashMap">
		/* 구매자 운송 정보 가져오기 */
		SELECT
				TRNSPRT_TYP_CD AS trnsprtTypCd,
				TRNSPRT_TYP_CD_NM AS trnsprtTypCdNm,
				TRNSPRT_AREA_CD_NM AS trnsprtAreaCdNm,
				TRNSPRT_SERVICE_CD_NM AS trnsprtServiceCdNm,
				FORMAT(TRNSPRT_PRC, 0) AS trnsprtPrc
		FROM 
				TBL_DA_DEAL_TRNSPRT_S
		WHERE 
				TRNSPRT_DIV_CD = 'B'
			AND	DEAL_SQ = #{dealSq}
			AND BUY_MBR_SQ = #{mbrSq}
	</select>
	<select id="selectTrnsprtInfoSell" resultType="hashMap" parameterType="hashMap">
		/* 판매자 운송 정보 가져오기 */
		SELECT
				TRNSPRT_TYP_CD AS trnsprtTypCd,
				TRNSPRT_TYP_CD_NM AS trnsprtTypCdNm,
				TRNSPRT_AREA_CD_NM AS trnsprtAreaCdNm,
				TRNSPRT_SERVICE_CD_NM AS trnsprtServiceCdNm,
				FORMAT(TRNSPRT_PRC, 0) AS trnsprtPrc
		FROM 
				TBL_DA_DEAL_TRNSPRT_S
		WHERE 
				TRNSPRT_DIV_CD = 'S'
			AND	DEAL_SQ = #{dealSq}
			AND SELL_MBR_SQ = #{mbrSq}
	</select>
	
	<select id="selectCalcInfo" resultType="hashMap" parameterType="String">
		/* 판매자 정산 정보를 가져온다 */
		SELECT 
				DEAL_FINAL_PRC AS dealFinalPrc,
				DEAL_SELL_FEE AS dealSellFee,
				DEAL_CALC_PRC AS dealCalcPrc,
				DATE_FORMAT(LAST_DAY(DATE_ADD(DEAL_ENDNG_DT, INTERVAL 1 MONTH)), '%Y.%m.%d') AS dealCalcDate
		FROM 
				TBL_DA_WORK_DEAL_H
		WHERE
				DEAL_SQ = #{dealSq}
			AND SELL_MBR_SQ = #{mbrSq}
	</select>
   <!-- 나의작품 / 소장품 거래등록 확인  -->
   <select id="dealWorkCount" resultType="int">
        SELECT
            count(*)
        FROM
            TBL_DA_DEAL_M 
        WHERE 
        	WORK_SQ = #{workSq}
   </select>
   
   <select id="beforeApplyCupon" parameterType="hashMap" resultType="long">
   		/* 쿠폰 할인 적용 전의 총 값 가져오기 */
   		SELECT
   				SUM(A.VALUE) AS totalAmt
   		FROM	(
   				SELECT
						TRNSPRT_SERVICE_CD_NM AS text,
						TRNSPRT_PRC AS value,
						TRNSPRT_REQ_YN AS regYn
				FROM 
						TBL_DA_TRNSPRT_PRC_MTRX
				WHERE 
						TRNSPRT_DIV_CD = #{trnsprtDivCd}
					<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
					AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
					</if>
					<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
					AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
					</if>
					AND TRNSPRT_REQ_YN = 'Y'
				UNION ALL
					SELECT
						TRNSPRT_SERVICE_CD_NM AS text,
						TRNSPRT_PRC AS value,
						TRNSPRT_REQ_YN AS regYn
				FROM 
						TBL_DA_TRNSPRT_PRC_MTRX
				WHERE 
						TRNSPRT_DIV_CD = #{trnsprtDivCd}
					<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
					AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
					</if>
					<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
					AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
					</if>
					<if test='trnsprtServiceCdNm != null and trnsprtServiceCdNm != ""'>
					AND TRNSPRT_SERVICE_CD_NM = #{trnsprtServiceCdNm}
					</if>
   		) A
   </select>
   
   <select id="applyCupon" parameterType="hashMap" resultType="hashMap">
   		/* 쿠폰 할인 적용 값 가져오기 */
   		SELECT
				TRNSPRT_SERVICE_CD_NM AS text,
				<if test='cuponDetailCd != null and cuponDetailCd != ""'>
				(
				CASE
				<if test='cuponDetailCd == "PSF"'>
					<if test='discTypCd == "AD"'>
					WHEN TRNSPRT_SERVICE_CD = 'SF' THEN FORMAT(TRNSPRT_PRC - ${cuponDiscAmt}, 0)
					</if>
					<if test='discTypCd == "DR"'>
					WHEN TRNSPRT_SERVICE_CD = 'SF' THEN FORMAT(TRNSPRT_PRC - (TRNSPRT_PRC * (${cuponDiscAmt} * 0.01)), 0)
					</if>
				</if>
				ELSE FORMAT(TRNSPRT_PRC, 0)
				END
				)AS value,
				</if>
				<if test='cuponDetailCd == null or cuponDetailCd == ""'>
				FORMAT(TRNSPRT_PRC, 0) AS value,
				</if>
				TRNSPRT_REQ_YN AS regYn
		FROM 
				TBL_DA_TRNSPRT_PRC_MTRX
		WHERE 
				TRNSPRT_DIV_CD = #{trnsprtDivCd}
			<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
			AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
			</if>
			<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
			AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			</if>
			AND TRNSPRT_REQ_YN = 'Y'
		UNION ALL
			SELECT
				TRNSPRT_SERVICE_CD_NM AS text,
				<if test='cuponDetailCd != null and cuponDetailCd != ""'>
				(
				CASE
				<if test='cuponDetailCd == "PSF"'>
					<if test='discTypCd == "AD"'>
					WHEN TRNSPRT_SERVICE_CD = 'SF' THEN FORMAT(TRNSPRT_PRC - ${cuponDiscAmt}, 0)
					</if>
					<if test='discTypCd == "DR"'>
					WHEN TRNSPRT_SERVICE_CD = 'SF' THEN FORMAT(TRNSPRT_PRC - (TRNSPRT_PRC * (${cuponDiscAmt} * 0.01)), 0)
					</if>
				</if>
				ELSE FORMAT(TRNSPRT_PRC, 0)
				END
				)AS value,
				</if>
				<if test='cuponDetailCd == null or cuponDetailCd == ""'>
				FORMAT(TRNSPRT_PRC, 0) AS value,
				</if>
				TRNSPRT_REQ_YN AS regYn
		FROM 
				TBL_DA_TRNSPRT_PRC_MTRX
		WHERE 
				TRNSPRT_DIV_CD = #{trnsprtDivCd}
			<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
			AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
			</if>
			<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
			AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
			</if>
			<if test='trnsprtServiceCdNm != null and trnsprtServiceCdNm != ""'>
			AND TRNSPRT_SERVICE_CD_NM = #{trnsprtServiceCdNm}
			</if>
   </select>
   
   <select id="applyCuponTotal" parameterType="hashMap" resultType="long">
   		/* 쿠폰 할인 적용 총 값 가져오기 */
   		SELECT
   				<if test='cuponDetailCd == null or cuponDetailCd == ""'>
   					<if test='discTypCd == "AD"'>
					SUM(A.VALUE) - ${cuponDiscAmt} AS totalAmt
					</if>
					<if test='discTypCd == "DR"'>
					SUM(A.VALUE) - (SUM(A.VALUE) * (${cuponDiscAmt} * 0.01)) AS totalAmt
					</if>
   				</if>
   				<if test='cuponDetailCd != null and cuponDetailCd != ""'>
   				SUM(A.VALUE) AS totalAmt
   				</if>
   				<if test='cuponSq == null or cuponSq == ""'>
   				SUM(A.VALUE) AS totalAmt
   				</if>
   		FROM	(
		   		SELECT
						TRNSPRT_SERVICE_CD_NM AS text,
						<if test='cuponDetailCd != null and cuponDetailCd != ""'>
						(
						CASE
						<if test='cuponDetailCd == "PSF"'>
							<if test='discTypCd == "AD"'>
							WHEN TRNSPRT_SERVICE_CD = 'SF' THEN TRNSPRT_PRC - ${cuponDiscAmt}
							</if>
							<if test='discTypCd == "DR"'>
							WHEN TRNSPRT_SERVICE_CD = 'SF' THEN TRNSPRT_PRC - (TRNSPRT_PRC * (${cuponDiscAmt} * 0.01))
							</if>
						</if>
						ELSE TRNSPRT_PRC
						END
						)AS value,
						</if>
						<if test='cuponDetailCd == null or cuponDetailCd == ""'>
						TRNSPRT_PRC AS value,
						</if>
						TRNSPRT_REQ_YN AS regYn
				FROM 
						TBL_DA_TRNSPRT_PRC_MTRX
				WHERE 
						TRNSPRT_DIV_CD = #{trnsprtDivCd}
					<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
					AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
					</if>
					<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
					AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
					</if>
					AND TRNSPRT_REQ_YN = 'Y'
				UNION ALL
					SELECT
						TRNSPRT_SERVICE_CD_NM AS text,
						<if test='cuponDetailCd != null and cuponDetailCd != ""'>
						(
						CASE
						<if test='cuponDetailCd == "PSF"'>
							<if test='discTypCd == "AD"'>
							WHEN TRNSPRT_SERVICE_CD = 'SF' THEN TRNSPRT_PRC - ${cuponDiscAmt}
							</if>
							<if test='discTypCd == "DR"'>
							WHEN TRNSPRT_SERVICE_CD = 'SF' THEN TRNSPRT_PRC - (TRNSPRT_PRC * (${cuponDiscAmt} * 0.01))
							</if>
						</if>
						ELSE TRNSPRT_PRC
						END
						)AS value,
						</if>
						<if test='cuponDetailCd == null or cuponDetailCd == ""'>
						TRNSPRT_PRC AS value,
						</if>
						TRNSPRT_REQ_YN AS regYn
				FROM 
						TBL_DA_TRNSPRT_PRC_MTRX
				WHERE 
						TRNSPRT_DIV_CD = #{trnsprtDivCd}
					<if test='trnsprtTypCd != null and trnsprtTypCd != "" and trnsprtTypCd != "null"'>
					AND TRNSPRT_TYP_CD = #{trnsprtTypCd}
					</if>
					<if test='trnsprtAreaCd != null and trnsprtAreaCd != "" and trnsprtAreaCd != "null"'>
					AND TRNSPRT_AREA_CD = #{trnsprtAreaCd}
					</if>
					<if test='trnsprtServiceCdNm != null and trnsprtServiceCdNm != ""'>
					AND TRNSPRT_SERVICE_CD_NM = #{trnsprtServiceCdNm}
					</if>
					) A
   </select>
   
   <select id="dealCheck" parameterType="String" resultType="int">
   		/*소장품 삭제 선택시 거래 등록 여부 확인*/
   		SELECT 
   				COUNT(*) 
		  FROM 
		  		TBL_DA_WORK_M AS A
		 		
		 INNER JOIN 
		 		TBL_DA_DEAL_M AS B ON A.WORK_SQ = B.WORK_SQ 
		  		  
		 WHERE 1=1 
		   AND A.WORK_SQ = #{workSq}
   </select>
   
   <update id="delCollection" parameterType="String">
		/* 소장품 삭제  */
		UPDATE 
				TBL_DA_WORK_M 
		SET		
				DEL_YN = 'Y',
				UPDT_DT = NOW()
		WHERE  
				WORK_SQ = #{workSq}
   </update>
</mapper>