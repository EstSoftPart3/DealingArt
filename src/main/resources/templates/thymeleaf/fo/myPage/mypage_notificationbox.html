<!DOCTYPE HTML>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
	<title>딜링아트</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="theme-color" content="#000000">
	
	<meta name="author" content="">
	<meta name="keywords" content="미술,아트,경매,수수료,정찰,운송,보험,직거래,dealingart">
	<meta name="description" content="미술품 거래의 새로운 트렌드">
	<meta property="og:description" content="미술품 거래의 새로운 트렌드">
	<meta property="og:type" content="website">
	<meta property="og:title" content="딜링아트">
	<meta property="og:image" content="https://www.dealing-art.com/resources/img/DA_logo_og.png">
	<meta property="og:url" content="https://www.dealing-art.com">
	
	<meta name="robots"content="noindex">
	
	<!-- google -->
    <meta name="google-site-verification" content="EKiW_Lm3Qw-DYnLT9qokEpZT2Sa8tSQuVWhVEvs4kPk" />
    <!-- faceBook -->
    <meta name="facebook-domain-verification" content="bgotqya9tcsrgrmspnq0uywh85kjzh" />
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- HTML의 <head> 섹션에 전체 사이트 태그를 복사합니다. -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-WRJBSR52MT"></script>
	
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	
	  gtag('config', 'G-WRJBSR52MT');
	</script>
	
	<!-- Google Tag Manager -->
	<!-- 페이지의 <head>에서 가능한 한 높은 위치에 코드를 붙여넣으세요. -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-NBP5CQ9');</script>
	<!-- End Google Tag Manager -->
			
	<!-- Google Tag Manager (noscript) -->
	<!-- 또한 여는 <body> 태그 바로 뒤에 코드를 붙여넣으세요. -->
	<noscript>
		<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NBP5CQ9"height="0" width="0" style="display:none; visibility:hidden"></iframe>
	</noscript>
	<!-- End Google Tag Manager (noscript) -->
	
	
	<!-- 페이스북 Meta Pixel Code -->
	<script>
	  !function(f,b,e,v,n,t,s)
	  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
	  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
	  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
	  n.queue=[];t=b.createElement(e);t.async=!0;
	  t.src=v;s=b.getElementsByTagName(e)[0];
	  s.parentNode.insertBefore(t,s)}(window, document,'script',
	  'https://connect.facebook.net/en_US/fbevents.js');
	  fbq('init', '5995234030505207');
	  fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=5995234030505207&ev=PageView&noscript=1"/></noscript>
    
    <style>
    	.head-wrap{border-bottom:#e9e9e9 1px solid;}
    	.swi-box::before{background-color:#f9f9f9;}
    	.footer-wrap{margin-top:0;}
    	.hd-div{background-color:#fff;}
    	[name=COLLworkClrCd]:checked+label{
		  outline: 5px solid gray;
		}
		[name=WORKworkClrCd]:checked+label{
		  outline: 5px solid gray;
		}
		/* Chrome, Safari, Edge, Opera */
		input::-webkit-outer-spin-button,
		input::-webkit-inner-spin-button {
		  -webkit-appearance: none;
		  margin: 0;
		}
		/* Firefox */
		input[type=number] {
		  -moz-appearance: textfield;
		}
    </style>
    
    <link rel="icon" type="image/png" href="/resources/img/favicon.png">
    <link type="text/css" rel="stylesheet" href="/resources/css/common_new.css"/>
</head>
<body>
	<th:block th:replace="thymeleaf/header :: headerFragment"></th:block>
    <div id="container">
        <div class="mypage_wrap">
            <h2>알림함</h2>
            <div class="mypage_contents">
              <div id = "left_menu"></div>
                <div class="contents_right">
                    <!-- <div class="mypage_search_wrap">
                        <div class="search">
                            <label for="search_input" class="hidden">검색</label>
                            <input type="text" id="search_input" placeholder="검색어를 입력해 주세요.">
                            <button class="btn_mypage_search"></button>
                        </div>
                        <button class="btn_mypage_registering">등록하기</button>
                    </div> -->
                    <div class="mypage_tap_wrap" id="tap">
                        <ul class="tap">
                            <li id="btn_nal1" class="on bg_no" onclick="offer('');"></li>
                            <li id="btn_nal2" onclick="offer('SEL');"></li>
                            <li id="btn_nal3" onclick="offer('PRC');"></li>
                            <li id="btn_nal4" onclick="offer('PIC');" class="bg_no"></li>
                        </ul>
                    </div>                    
                    <div class="mypage_notificationbox_contents_wrap mt30">
                        <div class="notibox_wrap" id="listBox">
                        
                        </div>
                        <div class="btn_area">
                            <button type= "button" onclick="notificationSearchMore()">더보기</button>
                        </div>     
                    </div>
              </div>
            </div>
        </div>
    </div>
    <th:block th:replace="thymeleaf/footer :: footerFragment"></th:block>
    <script type="text/javascript">

	var offset = 0;
	var obj = new Object();
	var limit = 0;
	var more = 1;
	var notiCatCd = "";
		
	$(document).ready(function(){
		
		$("#left_menu").load("/myPage/mypage_common_left");  // 레프트 메뉴 삽입
		
		// 알림 리스트 뿌려주기
		notificationboxList(notiCatCd);
	});
	
	//탭 클릭 이벤트
	function offer(notiCatCd1){
		more = 1;
		notiCatCd = notiCatCd1;
		$(".tap li").removeClass("on bg_no");
		if(notiCatCd == ""){
			$("#btn_nal1").addClass("on bg_no");
			notificationboxList("");
		}else if(notiCatCd == "SEL"){
			$("#btn_nal2").addClass("on bg_no");
			notificationboxList("SEL");
		}else if(notiCatCd == "PRC"){
			$("#btn_nal3").addClass("on bg_no");
			notificationboxList("PRC");
		}else if(notiCatCd == "PIC"){
			$("#btn_nal4").addClass("on bg_no");
			notificationboxList("PIC");
		}
	}
	
	//더보기 클릭
	function notificationSearchMore(){
		more += 1;
		notificationboxList(notiCatCd);
	}
	
	// 마이페이지 알림 목록 조회
	function notificationboxList(notiCatCd){
		
		//obj.notiCatCd = "";
		obj.limit = more * 3;
		obj.notiCatCd = notiCatCd;
		
		$.ajax({
			type: "POST",
			url: "/myPage/selectNotificationbox",
			data: obj,
			success: (function(response){
				setNotificationboxHtml(response.result);
				setNotificationCnt(response.myTotal, response.mySelTotal, response.myPrcTotal, response.myPicTotal);
			}),
			error: (function(response){
				console.log(response);
			})
		})
	}
	
	// 마이페이지 알림 목록 뿌려주기
	function setNotificationboxHtml(list){
		var strHtml = '';
		
		window.scrollTo({top:0});
		list.forEach(function(notificationbox){
			
			strHtml += '<div class="notibox_row" id="notificationbox_'+notificationbox.mbrSq+'">';
			strHtml += '	<div class="pic"><img src="'+notificationbox.workMainImgUrl+'" alt=""></div>';
			strHtml += '	<div class="notibox_tb">';
			strHtml += '		<table class="table">';
			strHtml += '			<tbody class="tbody">';
			strHtml += '				<tr>';
			strHtml += '					<th>작가</th>';
			strHtml += '					<td>'+notificationbox.artstActvtyNm+' ('+notificationbox.artstEnglsNm+')'+'</td>';
			strHtml += '				</tr>';
			strHtml += '				<tr>';
			strHtml += '					<th>작품명</th>';
			strHtml += '					<td>'+notificationbox.workNm+'';
			strHtml += '				</tr>';
			if(notificationbox.notiCatCd == "PRC"){
				let dealStrtPrc = notificationbox.dealStrtPrc.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
				let questionContent = notificationbox.questionContent.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
				
				strHtml += '				<tr>';
				strHtml += '					<td colspan="2" class="pd_tb30">현재가격 '+dealStrtPrc+' <img src="/resources/img/img_new/ico_arrow.png" alt="" class="arrow"> <em>제안가격 '+questionContent+'</em></td>'
				strHtml += '				</tr>';
			}else if(notificationbox.notiCatCd == "SEL"){
				strHtml += '				<tr>';
				strHtml += '					<td>판매 등록 해주세요</td>';
				strHtml += '				</tr>';
			}else if(notificationbox.notiCatCd == "PIC"){
				strHtml += '				<tr>';
				strHtml += '					<td>'+notificationbox.questionContent+'</td>';
				strHtml += '				</tr>';
			}
			strHtml += '				<tr class="bd_color_ch">';
			strHtml += '					<td colspan="2" class="notibox_user">';
			strHtml += '						<div class="user">';
			strHtml += '							<ul>';
			strHtml += '								<li class="time">'+notificationbox.time+'</li>';
			strHtml += '								<li><img src="'+notificationbox.mbrProfileImgUrl+'" alt=""></li>';
			strHtml += '								<li class="user_name"><span>'+notificationbox.mbrNckNm+'</span></li>';
			strHtml += '							</ul>';
			strHtml += '						</div>';
			strHtml += '					</td>';
			strHtml += '				</tr>';
			strHtml += '			</tbody>';
			strHtml += '		</table>';
			strHtml += '	</div>';
			strHtml += '</div>';
		});
		
		$(".notibox_wrap").empty();
        $(".notibox_wrap").append(strHtml).trigger('create');
	}
	
	//마이페이지 알림 개수 뿌려주기
	function setNotificationCnt(myTotal, mySelTotal, myPrcTotal, myPicTotal){
		$("#btn_nal1").text("전체("+myTotal+")");
		$("#btn_nal2").text("판매제안("+mySelTotal+")");
		$("#btn_nal3").text("가격협상("+myPrcTotal+")");
		$("#btn_nal4").text("사진요청("+myPicTotal+")");
	}
	</script>
</body>
</html>