<!DOCTYPE HTML>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">



<head>
    <style>
    	.head-wrap{border-bottom:#e9e9e9 1px solid;}
    </style>
</head>

<body>
	<div class="wrap">
	<th:block th:replace="thymeleaf/header :: headerFragment"></th:block>
		<div class="body-wrap">
			<div class="contents">
				
			 	<div th:text="${session.mbrSq}" id="mbrSq" style="display:none"></div>
				<div class="con-wrap2">
				    
				    <th:block th:replace="thymeleaf/myPageLeft :: myPageLeftFragment"></th:block>
					
					<div class="con-right2">
					
						<form name="form_chk" method="post">
							
							<div class="me-center">
								<div class="member-box">
									
									<div class="input-box input-group">
										<input type="hidden" id="uMbrSq" name="uMbrSq">
										<input type="text" class="input-3" id="uMbrId" name="uMbrId" placeholder="아이디/이메일" readonly/>
										
									</div>
									
									<p class="inp-p" id="emailCertificationCheck" style="display:none">이메일 인증 완료</p>
									<p class="inp-p" id="uMbrIdCheck" style="display:none">주로 사용하는 이메일을 입력해 주세요. 경매/판매 내역을 발송해 드립니다.</p>
									
									<div class="input-box">
										<input type="password" class="input-3" id="uMbrPasswrd" name="uMbrPasswrd" placeholder="비밀번호" />
										<p class="inp-p" id="uMbrPwdCheckU">영문/숫자/특수문자 2가지 이상 조합 (8~20자)</p>
										<p class="inp-p" id="uMbrPwdCheckD">3개 이상 연속되거나 동일한 문자/숫자 제외, 아이디(이메일) 제외</p>
									</div>
									<div class="input-box">
										<input type="password" class="input-3" placeholder="비밀번호 확인" id="uMbrPasswrdConfirm" name="uMbrPasswrdConfirm"/>
										<p class="inp-p">확인을 위해 새 비밀번호를 다시 입력해주세요.</p>
									</div>					
									<div class="input-box">
										<input type="text" class="input-3" placeholder="이름" id="uMbrNm" name="uMbrNm" readonly/>
										<p class="inp-p" id="uMbrNmCheck"></p>
									</div>
									<div class="input-box input-group">
										<input type="text" class="input-3" placeholder="휴대폰 번호" id="uMbrCpNum" name="uMbrCpNum" readonly/>
										<button type="button" class="group-btn phone" id="SmsCertification">인증하기</button>
										<input type="hidden" id="uMbrCpCertYn" name="uMbrCpCertYn" value="N">
										<input type="hidden" id="uMbrCpCertDate" name="uMbrCpCertDate" value="">
									</div>
									
									<div class="input-box">
										<p class="inp-p" id="smsCertificationCheck" style="display:none;color:red">휴대폰 인증완료</p>
									</div>
									<div class="bat-box3 mg_t65">
										<button type="button" class="ba-btn1" id="memberUpdateBtn"><span>회원 정보 수정하기</span></button>
									</div>
									
									<div class="mypage-btn">
										<a href="/withdrawal" class="my-btn">회원탈퇴</a>
									</div>
								</div>
							</div>
						</div>
						
						<input type="hidden" name="m" value="checkplusSerivce">	<!-- 필수 데이타로, 누락하시면 안됩니다. -->
						<input type="hidden" name="EncodeData">					<!-- 위에서 업체정보를 암호화 한 데이타입니다. -->
			
					</form>
				</div>
				
			</div>
		</div>
		
		<th:block th:replace="thymeleaf/footer :: footerFragment"></th:block>
	</div>

<script type="text/javascript"> 

$(document).ready(function() {
	
	$('#SmsCertification').click(function() {
		
		$.ajax({
			method: "POST",
			url: "/auth/phone"
		}).done(function(data) {
			document.form_chk.EncodeData.value = data;
			window.open('', 'popupChk', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
			document.form_chk.action = "https://nice.checkplus.co.kr/CheckPlusSafeModel/checkplus.cb";
			document.form_chk.target = "popupChk";
			document.form_chk.submit();
		});
	});

});



//등록된 이메일 사용 여부
$("#userInputEmailUsing").change(function(){
	
	 if($("#userInputEmailUsing").is(":checked")){
         //체크박스 체크
         $("#uMbrId").attr("readonly",true);
         //설명 문구
         $("#uMbrIdCheck").hide();
	}else{
    	//체크박스 체크 해제
		$("#uMbrId").attr("readonly",false);
    	//설명 문구
    	$("#uMbrIdCheck").show();
    	$("#uMbrIdCheck").html("주로 사용하는 이메일을 입력해 주세요. 경매/판매 내역을 발송해 드립니다.");
    	$("#uMbrIdCheck").css("color","#999999");
     }
});


//이메일 인증
$("#EmailCertification").on('click', function(event){

	var mbrId = $("#uMbrId").val()
	
	var params = {
		mbrId : mbrId	
	}
	$.ajax({
	     type: "post",
	     url: "/myPage/memberUpdatEmailCertification",
	     data: params,
	     success: function(data) {
	    	 console.log(data);
	    	 modalAlertShow("인증번호 발송이 완료되었습니다.<br>입력한 이메일에서 인증번호 확인을 해주십시오.","");
	    	 $("#emailCertCode").show();
	    	 $("#emailCertChk").val(data);
	   	 },
	     error: function(error) {
	  	   var errorJson = JSON.stringify(error);
	         console.log(errorJson);
	     }
	})
	
});

//이메일 인증번호 대조
$("#emailCertBtn").click(function(){
	
	var emailCertChk = $("#emailCertChk").val();
	var emailCert	= $("#emailCert").val();
	
	console.log("emailCertChk :"+emailCertChk);
	console.log("emailCert :"+emailCert);
	
	if(emailCert == emailCertChk){
		modalAlertShow("인증번호가 일치 합니다.","");
		$("#emailCertCode").hide();
		
	}else{
		modalAlertShow("인증번호가 일치하지 않습니다.","");
	}
});

//회원수정
$("#memberUpdateBtn").on('click', function(event){
	
	//회원번호
	var mbrSq = $("#uMbrSq").val();
	//회원아이디
	var mbrId = $("#uMbrId").val();
	//비밀번호
	var mbrPasswrd = $("#uMbrPasswrd").val();
	//비밀번호 확인
	var mbrPasswrdConfirm = $("#uMbrPasswrdConfirm").val();
	//성명
	var mbrNm = $("#uMbrNm").val();
	//휴대번호
	var mbrCpNum = $("#uMbrCpNum").val();
	//휴대폰 본인인증 여부
	var mbrCpCertYn = $("#uMbrCpCertYn").val();
	//휴대폰 본인인증 날짜
	var mbrCpCertDate = $("#uMbrCpCertDate").val();
	
	//비밀번호--------------------------------------------------------------------//
	//비밀번호 문자 입력이 안되었다면..
	if(isEmpty(mbrPasswrd)) {
		$('#uMbrPwdCheckU').css('color','red');
		$('#uMbrPwdCheckD').css('color','#999999');
		return;
	} 
	
	$('#uMbrPwdCheckU').css('color','#999999');
	
	//영어,숫자,특수문자 8~20사이
	if(!/^[a-zA-Z0-9!@#$%^&*()?_~]{8,20}$/.test(mbrPasswrd))
	{
		$('#uMbrPwdCheckU').css('color','red');
		$('#uMbrPwdCheckD').css('color','#999999');
		return;
	}
	
	
	var chk = 0;
	if(mbrPasswrd.search(/[0-9]/g) != -1 ) chk ++;
	if(mbrPasswrd.search(/[a-z]/ig)  != -1 ) chk ++;
	if(mbrPasswrd.search(/[!@#$%^&*()?_~]/g)  != -1  ) chk ++;
	
	console.log("chk :"+chk);
	
	if(chk < 3)
	{
		console.log("check_chk");
		$('#uMbrPwdCheckU').css('color','#999999');
		$('#uMbrPwdCheckD').css('color','red');
		return;
	}
	
	$('#uMbrPwdCheckU').css('color','#999999');
	
	 var SamePass_0 = 0; //동일문자 카운트
	 var SamePass_1 = 0; //연속성(+) 카운드
	 var SamePass_2 = 0; //연속성(-) 카운드
	 
	 var chr_pass_0;
	 var chr_pass_1;
	 
	 for(var i=0; i < mbrPasswrd.length; i++) {
	  chr_pass_0 = mbrPasswrd.charAt(i);
	  chr_pass_1 = mbrPasswrd.charAt(i+1);
	 
	  //동일문자 카운트
	  if(chr_pass_0 == chr_pass_1) {
	   SamePass_0 = SamePass_0 + 1
	  } // if
	 
	 
	  //연속성(+) 카운드
	  if(chr_pass_0.charCodeAt(0) - chr_pass_1.charCodeAt(0) == 1) {
	   SamePass_1 = SamePass_1 + 1
	  } // if
	 
	  //연속성(-) 카운드
	  if(chr_pass_0.charCodeAt(0) - chr_pass_1.charCodeAt(0) == -1) {
	  	SamePass_2 = SamePass_2 + 1
	  } // if
	 } // for
	 
	 if(SamePass_0 > 1) {
		 $('#uMbrPwdCheckU').css('color','#999999');
		 $('#uMbrPwdCheckD').css('color','red');
		 return;
	 } // if
	 
	 if(SamePass_1 > 1 || SamePass_2 > 1 )  {
		 $('#uMbrPwdCheckU').css('color','#999999');
		 $('#uMbrPwdCheckD').css('color','red');
		 return;
	 }
	
	 // 비밀번호 아이디 포함 여부
	 if(mbrPasswrd.search(mbrId)>-1)
	 {
		 $('#uMbrPwdCheckU').css('color','#999999');
		 $('#uMbrPwdCheckD').css('color','red');
		  return;
	 }
	
	 $('#uMbrPwdCheckU').css('color','#999999');
	 $('#uMbrPwdCheckD').css('color','#999999');
	 
	 //비밀번호.비밀번호확인 일치 체크 mbrPwdReCheck
	 if(mbrPasswrd != mbrPasswrdConfirm) {
		fn_validation('mbrPwdReCheck','비밀번호가 일치 하지 않습니다.', 'R');
		return;
	 }
	
	 fn_validation('mbrPwdReCheck','확인을 위해 새 비밀번호를 다시 입력해주세요.', 'B');
	//비밀번호--------------------------------------------------------------------//
	
	if(isEmpty(mbrNm)) {
		 fn_validation('uMbrNmCheck','이름을 정확히 입력하세요', 'R');
		 return;
	 }
	fn_validation('uMbrNmCheck','', 'B')
	
	//휴대폰번호
	 if(isEmpty(uMbrCpNum)) {
		 fn_validation('uMbrCpNumCheck','휴대폰번호를 정확히 입력하세요.', 'R');
		 return;
	 }
	 
	fn_validation('uMbrCpNumCheck','', 'B');
	
	//휴대폰본인인증 여부
	if(mbrCpCertYn == 'N') {
		$("#smsCertificationCheck").show();
		fn_validation('smsCertificationCheck','휴대폰 본인 인증을 해주세요.', 'R');
		return;
	}
	
	let memParams = {
	  "mbrSq" : mbrSq,
	  "mbrId" : mbrId,
	  "mbrEmail" : mbrId,
	  "mbrPasswrd" : mbrPasswrd,
	  "mbrNm" : mbrNm,
	  "mbrCpNum" : mbrCpNum, 
	  "mbrCpCertYn" : mbrCpCertYn,
	  "mbrCpCertDate" : mbrCpCertDate
	}
	
	 $.ajax({
	     type: "post",
	     url: "/myPage/memberUpdateData",
	     data: memParams,
	     success: function(data) {
	    	 modalAlertShow("회원수정이 완료 되었습니다.","reload");
	    	
	   	 },
	     error: function(error) {
	  	   var errorJson = JSON.stringify(error);
	         console.log(errorJson);
	     }
	})
	
});

//휴대폰 인증 성공
function mobileAuthSuccess()
{
		
	$("#smsCertificationCheck").css('display',"block");
	fn_validation('smsCertificationCheck','휴대폰 인증완료.', 'B');
}


//휴대폰 인증 실패
function mobileAuthFail()
{
	modalAlertShow("인증에 실패했습니다.","");
	
}



$(window).on("resize", function () {
    if(window.matchMedia('(min-width: 1537px)').matches){
  	    document.querySelectorAll(".item").forEach((item) => {
      	     item.style.gridRowEnd = `span ${item.clientHeight + 0}`;
      	  });
  	    
    }else if(window.matchMedia('(min-width: 751px)').matches) {
    	
  	      document.querySelectorAll(".item").forEach((item) => {
      	     item.style.gridRowEnd = `span ${item.clientHeight + 280}`;
      	  });
    	
    }else{
    	var swiper = new Swiper(".mySwiper2", {
          slidesPerView: 1,
          slidesPerGroup: 1,
          loop: true,
          loopFillGroupWithBlank: true,
          pagination: {
            el: ".swiper-pagination",
            clickable: true
          },
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev"
          }
     });
    	
    	document.querySelectorAll(".item").forEach((item) => {
      	     item.style.gridRowEnd = `span ${item.clientHeight + 150}`;
      	  });
  	  
     }
}).resize();



$(function () {
  $(".elm").hover(
	function(){ $(this).addClass('hover') },
	    function(){ $(this).removeClass('hover') }
	  )
	  $(".cn-b").hover(
	function(){ $(this).addClass('gis') },
	    function(){ $(this).removeClass('gis') }
	  )
});

$(function() {                      
  $(".bab-bo").click(function() { 
    $(this).toggleClass("bashow");     
  });
  
  $(".lg-my").click(function() { 
	    $('.bg-sh').toggleClass('bg-show');     
	 	$('.s-hov').toggleClass('s-hov-show');     
	  });
  
});

$(function() {
	/* 메뉴바 FIXED */
	if (jQuery(window).width() > 0) {
	  jQuery(window).on("scroll",function(ev){
	      if(jQuery(window).scrollTop() > 80 ) { /* 해당 높이를 벗어나면 fixed 클래스 추가 */
	          jQuery('.head-wrap').addClass('fixed');
	      }else{
	          jQuery('.head-wrap').removeClass('fixed');
	      }
	      return false;
	  });
	}
});

/* jQuery(function($) {

    window.onresize = function(){
      document.location.reload();
    };

}); */



var delay = 300;
var timer = null;

//Javascript
window.addEventListener('resize', function(){
	clearTimeout(timer);
	timer = setTimeout(function(){
		document.location.reload();
	}, delay);
});

//jQuery
$(window).on('resize', function(){
	clearTimeout(timer);
	timer = setTimeout(function(){
		document.location.reload();
	}, delay);
});

$('ul.dropdown-menu.mega-dropdown-menu').on('click', function(event){
    // The event won't be propagated up to the document NODE and 
    // therefore delegated events won't be fired
    event.stopPropagation();
});

//회원 정보 호출
function memberContentData(mbrSq) {
	
	console.log("memberContentData : "+ mbrSq);
	
	$.ajax({
           type: "post",
           url: "/myPage/memberContentData",
           data: {
        	   mbrSq : mbrSq
            },
           success: function(data) {
        	 
        	 if (typeof data != "undefined") {
        	 
        		console.log(data);   
        	 	dataContent = data.memberContentData.memberContent[0];
        	 
        	 	console.log(dataContent);
        	 	var mbrSq = dataContent.mbrSq						//이름
        	 	var mbrNm = dataContent.mbrNm						//이름
        	 	var mbrId = dataContent.mbrId						//아이디
        	 	var mbrNcknm = dataContent.mbrNcknm				//닉네임
        	 	var mbrEmail = dataContent.mbrEmail				//이메일
        	 	var mbrBirth = dataContent.mbrBirth				//생년월일
        	 	var mbrSexCd = dataContent.mbrSexCd				//성별
        	 	var mbrCpNum = dataContent.mbrCpNum				//휴대폰번호
        	 	var regDt = dataContent.regDt						//회원등록일시
        	 	var mbrHomeAddr = dataContent.mbrHomeAddr			//집주소
        	 	var mbrDelivryAddr = dataContent.mbrDelivryAddr	//배송지 주소
        	 	var useYn = dataContent.useYn						//사용여부
        	 
        	 	$("#uMbrSq").val(mbrSq);
        	 	$("#uMbrNm").val(mbrNm);
        	 	$("#uMbrId").val(mbrId);
        	 	$("#mbrNcknm").val(mbrNcknm);
        	 	$("#uMbrCpNum").val(mbrCpNum);
        	 
        	 }
           },
           error: function(error) {
        	   var errorJson = JSON.stringify(error);
               console.log(errorJson);
           }
	})
}


$( document ).ready(function() {
 	var sMbrSql = $("#mbrSq").html();
 	
	 memberContentData(sMbrSql);
});

jQuery(document).ready(function() {
	if(sAuthSqVal == 2){
		document.getElementById("portfolio").style.display="";
	}
	$("#conTitle").empty();
	const conBtn = document.getElementById("conBtn");
	conBtn.remove();
	var conTitleHtml = "";
	conTitleHtml += '<h3>설정</h3>';
	$("#conTitle").append(conTitleHtml).trigger("create");
});   
</script>
	
</body>

</html>
